(()=>{var e={880:()=>{function e(e){if(/^\d{2}\/\d{2}\/\d{4} \d{2}:\d{2}$/.test(e))return e;if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(e)){const[t,n]=e.split(" "),[a,o,i]=t.split("-"),[s,r]=n.split(":");return`${i}/${o}/${a} ${s}:${r}`}throw new Error("Invalid date format")}ko.components.register("time-slot-pill",{viewModel:function(t){const n=this;n.schedule=t.schedule,n.selectedResources=t.selectedResources,console.log(t),n.date=t.date,n.options={hour:"2-digit",minute:"2-digit"},console.log(n.date),n.startTime=ko.computed((()=>luxon.DateTime.fromFormat(e(n.date.from_),"dd/MM/yyyy HH:mm").toJSDate())),n.endTime=ko.computed((()=>luxon.DateTime.fromFormat(e(n.date.to_),"dd/MM/yyyy HH:mm").toJSDate())),n.toDateStr=e=>`${e.getDate()}. ${monthNamesShort[e.getMonth()].toLowerCase()}`,n.toTimeStr=(e,t)=>t?`${e.toLocaleTimeString("no",n.options).replace(":",".")} -\n                ${t.toLocaleTimeString("no",n.options).replace(":",".")}`:e.toLocaleTimeString("no",n.options).replace(":","."),n.removeDate=t.removeDate,n.error=ko.computed((()=>{if(!n.schedule||!n.selectedResources)return!1;const e={date:luxon.DateTime.fromJSDate(n.startTime()).toFormat("yyyy-MM-dd"),from:luxon.DateTime.fromJSDate(n.startTime()).toFormat("HH:mm:ss"),to:luxon.DateTime.fromJSDate(n.endTime()).toFormat("HH:mm:ss"),resources:n.selectedResources()},t=n.schedule().find((t=>function(e,t){if(e.date!==t.date)return!1;if("allocation"===t.type||"booking"===t.type)return!1;const n=e.from<t.to&&e.to>t.from,a=e.resources.some((e=>t.resources.some((t=>e.id===t.id))));return n&&a}(e,t)));return t?`${e.resources.find((e=>t.resources.some((t=>t.id===e.id)))).name} ikke tilgjengelig`:void 0}))},template:'\n\n        <div class="pill pill--secondary" data-bind="css: {\'pill--error\': error}">\n            \x3c!-- ko if: startTime().getMonth() === endTime().getMonth() && startTime().getFullYear() === endTime().getFullYear() && startTime().getDate() === endTime().getDate() --\x3e\n            <div class="pill-label">\n                <span className="text-primary text-bold" data-bind="text: toDateStr(startTime())"></span>\n            </div>\n            <div class="pill-divider"></div>\n            <div class="pill-time"\n                 data-bind="text: toTimeStr(startTime(), endTime()), css: {\'last-child\': !removeDate}">\n\n            </div>\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko ifnot: (startTime().getMonth() === endTime().getMonth() && startTime().getFullYear() === endTime().getFullYear() && startTime().getDate() === endTime().getDate()) --\x3e\n            <div class="pill-content gap-1">\n                <div class="date"><span class="text-primary text-bold" data-bind="text: toDateStr(startTime())"></span>\n                    <span data-bind="text: toTimeStr(startTime())"></span>\n                </div>\n                <span> - </span>\n                <div class="time"><span class="text-primary text-bold" data-bind="text: toDateStr(endTime())"></span>\n                    <span data-bind="text: toTimeStr(endTime())"></span>\n                </div>\n            </div>\n\n            \x3c!-- /ko --\x3e\n\n            \x3c!-- ko if: !!removeDate --\x3e\n            <button class="pill-icon" data-bind="click: removeDate"><i class="pill-cross"></i></button>\n            \x3c!-- /ko --\x3e\n\n        </div>\n        \x3c!-- ko if: error --\x3e\n        <div class="d-flex align-items-center gap-2">\n            <svg class="font-size-small" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M6.00011 0.75C6.33292 0.75 6.63996 0.925781 6.80871 1.21406L11.8712 9.83906C12.0423 10.1297 12.0423 10.4883 11.8759 10.7789C11.7095 11.0695 11.3978 11.25 11.0626 11.25H0.937611C0.602455 11.25 0.290736 11.0695 0.12433 10.7789C-0.042076 10.4883 -0.0397323 10.1273 0.129018 9.83906L5.19152 1.21406C5.36027 0.925781 5.6673 0.75 6.00011 0.75ZM6.00011 3.75C5.68839 3.75 5.43761 4.00078 5.43761 4.3125V6.9375C5.43761 7.24922 5.68839 7.5 6.00011 7.5C6.31183 7.5 6.56261 7.24922 6.56261 6.9375V4.3125C6.56261 4.00078 6.31183 3.75 6.00011 3.75ZM6.75011 9C6.75011 8.80109 6.67109 8.61032 6.53044 8.46967C6.38979 8.32902 6.19902 8.25 6.00011 8.25C5.8012 8.25 5.61043 8.32902 5.46978 8.46967C5.32913 8.61032 5.25011 8.80109 5.25011 9C5.25011 9.19891 5.32913 9.38968 5.46978 9.53033C5.61043 9.67098 5.8012 9.75 6.00011 9.75C6.19902 9.75 6.38979 9.67098 6.53044 9.53033C6.67109 9.38968 6.75011 9.19891 6.75011 9Z"\n                      fill="#B00020"/>\n            </svg>\n            <span class="text-small text-red-error" data-bind="text: error"></span>\n        </div>\n        \x3c!-- /ko --\x3e\n    '})},940:()=>{if(!globalThis.trans){globalThis.translations=ko.observable({});const e=phpGWLink("bookingfrontend/lang.php",null,!0);fetch(e).then((e=>e.json())).then((e=>globalThis.translations(e))),globalThis.trans=(e,t,...n)=>{const a=globalThis.translations(),o=e=>a[e]&&a[e][t]?a[e][t].replace(/%\d+/g,(e=>{const t=parseInt(e.substring(1))-1;return void 0!==n[t]?n[t]:e})):null;if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=o(e[t]);if(null!==n)return n}else{const t=o(e);if(null!==t)return t}if(!Array.isArray(e)||!e.includes("common")){const e=o("common");if(null!==e)return e}return`Missing translation for [${Array.isArray(e)?e.join(", "):e}][${t}]`};class t{constructor(e,t){let n=t.templateNodes.map((e=>e.textContent));1===n.length&&n[0].includes(":")&&(n=n[0].split(":")),n=n.map((e=>e.trim())),n.length>=2?(this.tag=ko.observable(n[1]),this.group=ko.observable(n[0])):(this.tag="function"==typeof e.tag?e.tag:ko.observable(e.tag),this.group="function"==typeof e.group?e.group:ko.observable(e.group)),this.suffix=ko.observable(e.suffix||""),this.args=ko.observable(e.args),this.translations=globalThis.translations,this.translated=ko.computed((()=>{if(self.translations&&self.translations()&&Object.keys(self.translations()).length>0&&this.group&&this.tag)return globalThis.trans(this.group(),this.tag(),this.args())+this.suffix()}))}}ko.components.register("trans",{viewModel:{createViewModel:function(e,n){return new t(e,n)}},template:"\x3c!--ko text: translated()--\x3e\x3c!--/ko--\x3e"})}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}(()=>{"use strict";function e(e,t,n,a){if(a){const e=a.split("/").filter((e=>""!==e&&!e.includes("http")));a="//"+e.slice(0,e.length-1).join("/")+"/"}const o=(a||strBaseURL).split("?");let i=o[0]+e+"?";null==t&&(t=new Object);for(const e in t)i+=e+"="+t[e]+"&";return o[1]&&(i+=o[1]),n&&(i+="&phpgw_return_as=json"),i}n(940),$(document).ready((function(){$("input[type=radio][name=select_template]").change((function(){var t=$(this).val(),n=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{template_set:t},url:n,success:function(e){location.reload(!0)}})})),$("input[type=radio][name=select_language]").change((function(){var t=$(this).val(),n=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{lang:t},url:n,success:function(e){location.reload(!0)}})}))})),n(880);class t{constructor(e){this.applicationCartItems=e.applicationCartItems,this.cartElementExpanded=ko.observable(!0),this.popperInstance=ko.observable(),this.isVisible=ko.observable(!1),this.deleteItem=e.deleteItem,this.applicationCartItems.subscribe((e=>console.log(e)))}initializePopper(e){const t=e.previousElementSibling;this.popperInstance(new Popper(t,e,{placement:"bottom-end",strategy:"fixed"}))}destroyPopperInstance(){this.popperInstance()&&(this.popperInstance().destroy(),this.popperInstance(null))}togglePopper(e=void 0){let t=this.popperInstance();t&&(this.isVisible(e||!this.isVisible()),t.update())}toggleCartExpansion(){this.cartElementExpanded(!this.cartElementExpanded())}popperAttr=ko.computed((()=>this.isVisible&&this.isVisible()?{"data-show":""}:{}))}ko.components.register("shopping-basket",{viewModel:{createViewModel:(e,n)=>new t(e,n)},template:'\n        <button class="pe-btn menu__toggler" type="button" aria-expanded="false"\n                data-bind="click: () => togglePopper()">\n    <span class="text">\n        <i class="fa-solid fa-basket-shopping"></i>\n        <span class="badge badge-light" style="position: absolute;top: -5px;"\n              data-bind="visible: applicationCartItems().length > 0, text: applicationCartItems().length">-1\n        </span>\n    </span>\n        </button>\n        <div class="poppercontent"\n             style="z-index: 11"\n             data-bind="withAfterRender: {afterRender: (d) => initializePopper(d)}, visible: applicationCartItems().length > 0 && isVisible, attr: popperAttr()">\n            <div class="dialog-container">\n                <div class="dialog-header">\n                    <span class="dialog-title">Søknader klar for innsending</span>\n                    <button type="button" class="btn-close" data-bind="click: () => togglePopper(false)"\n                            aria-label="Close"></button>\n                </div>\n                <div class="dialog-ingress">\n                    <p>Her er en oversikt over dine søknader som er klar for innsending og godkjennelse.</p>\n                </div>\n                <div class="dialog-content">\n                    \x3c!-- Content goes here --\x3e\n                    <div class="article-table-wrapper" data-bind="visible: cartElementExpanded">\n                        <div data-bind="foreach: applicationCartItems">\n\n                            <div class="article-table-header title-only">\n                                <div class="resource-name" data-bind="text: building_name"></div>\n                                <div class="resource-expand float-right">\n                                    <span class="far fa-trash-alt mr-2" data-bind="click: $parent.deleteItem"></span>\n                                </div>\n                            </div>\n                            <div class="category-table">\n\n                                    <div class="category-header category-article-row d-flex flex-wrap">\n                                        \x3c!-- ko foreach: { data: resources, as: \'item\' } --\x3e\n\n                                        <div class="pill pill">\n                                            <i class="fa-solid fa-layer-group"></i>\n                                            <div class="pill-label" data-bind="text: item.name"></div>\n                                        </div>\n                                        \x3c!-- /ko --\x3e\n\n                                    </div>\n\n                                <div class="category-articles">\n                                    <div class="category-article-row d-flex  flex-wrap">\n                                        \x3c!-- ko foreach: { data: dates, as: \'s\' } --\x3e\n                                        <time-slot-pill params="date: s"></time-slot-pill>\n                                        \x3c!-- /ko --\x3e\n\n                                    </div>\n                                </div>\n\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="dialog-actions">\n                    <a class="pe-btn pe-btn-primary pe-btn-colour-primary link-text link-text-white d-flex gap-3"\n                       data-bind="attr: { href: phpGWLink(\'bookingfrontend/\', {menuaction:\'bookingfrontend.uiapplication.add_contact\' }, false) } ">\n                        <div class="text-bold">\n                            <trans params="group: \'bookingfrontend\', tag:\'complete_applications\'"></trans>\n                        </div>\n                        <div class="text-bold d-flex align-items-center">\n                            <i class="fa-solid fa-arrow-right-long"></i>\n                        </div>\n                    </a>\n                </div>\n            </div>\n        </div>\n    '});let a=new class{constructor(){this.applicationCartItems=ko.observableArray([]),this.applicationCartItemsEmpty=ko.observable(!1),this.visible=ko.observable(!0),this.initializeCart()}initializeCart(){this.getApplicationsCartItems()}deleteItem(t){console.log("got delete request");const n=e("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.delete_partial"},!0);confirm("Do you want to delete this application?")&&fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then((e=>e.json())).then((()=>this.getApplicationsCartItems())).catch((e=>console.error("Error:",e)))}getApplicationsCartItems(){const t=e("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.get_partials"},!0);fetch(t).then((e=>e.json())).then((e=>this.updateCartItems(e))).catch((e=>console.error("Error fetching cart items:",e)))}updateCartItems(e){const{list:t,total_sum:n}=e;this.applicationCartItemsEmpty(t.length<1),this.applicationCartItems(t.map((e=>({...e,dates:e.dates.map((e=>{const t=new Date(e.from_.replace(" ","T"));t.setHours(e.from_.substring(11,13)),t.setMinutes(e.from_.substring(14,16));const n=new Date(e.to_.replace(" ","T"));return n.setHours(e.to_.substring(11,13)),n.setMinutes(e.to_.substring(14,16)),{date:formatSingleDateWithoutHours(t),from_:e.from_,to_:e.to_,periode:formatPeriodeHours(t,n)}})),resources:ko.observableArray(e.resources.map((e=>({...e})))),joinedResources:e.resources.map((e=>e.name)).join(", ")}))))}};var o;o=()=>{const e=document.getElementById("application-cart-container")||document.getElementById("applications-cart-content");e&&(console.log("INITIALISING CART"),ko.applyBindings(a,e))},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(o,1):document.addEventListener("DOMContentLoaded",o),$(".navbar-search").removeClass("d-none"),document.location.origin,window.location.pathname.split("/")[1],CreateUrlParams(window.location.search),ko.validation.locale("nb-NO");class i{constructor(){this.isFormVisible=ko.observable(!0);const e=document.getElementById("customer_identifier_type_hidden_field").value;this.typeApplicationRadio=ko.observable(e||"ssn"),this.applicationCartItems=ko.computed((()=>(console.log(a.applicationCartItems()),a.applicationCartItems()))),this.applicationCartItemsEmpty=ko.computed((()=>{a.applicationCartItemsEmpty()&&(window.location.href=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uisearch.index"},!1))})),this.typeApplicationRadio.subscribe((e=>console.log(e))),this.typeApplicationSelected=ko.computed((()=>"undefined"!==this.typeApplicationRadio()&&null!==this.typeApplicationRadio())),this.typeApplicationValidationMessage=ko.observable(!1),this.applicationSuccess=ko.observable(!1)}deleteItem(e){a.deleteItem(e)}}function s(e){var t=!1,n=$("#application_form")[0],a=n.checkValidity();if(!a){var o=n.querySelectorAll(":invalid");for(var i of o)console.log(i),i.setAttribute("style","background-color: red;")}return a||(t=!0,e.preventDefault(),e.stopPropagation()),document.getElementById("contact_email2").value!==document.getElementById("contact_email").value?(document.getElementById("contact_email2").classList.replace("valid","invalid"),t=!0,alert("Epostadressen er ikke den samme i begge feltene")):document.getElementById("contact_email2").classList.replace("invalid","valid"),n.classList.add("was-validated"),!t||(alert("Fyll ut alle obligatoriske felt"),!1)}$(document).ready((function(){var e=new i;ko.applyBindings(e,document.getElementById("new-application-partialtwo")),a.visible(!1);var t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiorganization.get_organization_list"},!0);async function n(){var e=document.getElementById("application_form"),t=document.createElement("div");t.id="spinner",t.className="text-center mt-2 ml-2";var n=document.createElement("div");n.className="spinner-border",n.setAttribute("role","status");var a=document.createElement("span");a.className="sr-only",a.textContent="Processing...",n.appendChild(a),t.appendChild(n),e.parentNode.insertBefore(t,e.nextSibling);var o=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.update_contact_informtation"},!0),i=new FormData(e);try{let e=await fetch(o,{method:"POST",body:i}),t=await e.json();if(t){"saved"!==t.status?(alert(t.message),window.location.reload()):(""!==document.getElementById("total_sum").textContent&&!1!==t.direct_booking||(document.getElementById("external_payment_method").style.display="none",document.getElementById("btnSubmit").textContent="Send"),t.contact_info.responsible_street&&(document.getElementById("field_responsible_street").value=t.contact_info.responsible_street),t.contact_info.responsible_zip_code&&(document.getElementById("field_responsible_zip_code").value=t.contact_info.responsible_zip_code),t.contact_info.responsible_city&&(document.getElementById("field_responsible_city").value=t.contact_info.responsible_city));var s=document.getElementById("spinner");s&&s.parentNode.removeChild(s)}}catch(e){console.error("Error:",e)}}$("#customer_organization_number").select2({ajax:{url:t,dataType:"json",delay:250,data:function(e){return{query:e.term,page:e.page||1}},cache:!0},width:"100%",placeholder:"Søk etter din organisasjon/bedrift med navn eller organisasjonsnummer",minimumInputLength:2,language:"no",allowClear:!0}),$("#customer_organization_number").on("select2:open",(function(e){$(".select2-search__field").each((function(){"select2-customer_organization_number-results"==$(this).attr("aria-controls")&&$(this)[0].focus()})),$("input[name='customer_organization_number_fallback']").prop("readonly",!0),$("input[name='customer_organization_name']").prop("readonly",!0)})),$("#customer_organization_number").on("select2:select",(function(e){var t=e.params.data;$("input[name='customer_organization_number_fallback']").val(t.organization_number),$("input[name='customer_organization_name']").val(t.name)})),$("#customer_organization_number").on("select2:clear",(function(e){$("input[name='customer_organization_number_fallback']").prop("readonly",!0),$("input[name='customer_organization_number_fallback']").val(""),$("input[name='customer_organization_name']").prop("readonly",!0),$("input[name='customer_organization_name']").val(""),$("#customer_organization_number").prop("required",!0)})),function(){if(payment_order_id){var e=selected_payment_method,t=document.getElementById("new-application-partialtwo");t.style.display="none",$('<div id="spinner" class="text-center mt-2  ml-2">').append($('<div class="spinner-border" role="status">').append($('<span class="sr-only">Checking...</span>'))).insertAfter(t);var n={menuaction:"bookingfrontend."+e+"_helper.check_payment_status",payment_order_id},a=phpGWLink("bookingfrontend/",n,!0);$.getJSON(a,(function(e){var t=document.getElementById("spinner");t&&t.parentNode.removeChild(t),console.log(e);var n=e.transactionLogHistory[0];!0===n.operationSuccess&&("RESERVE"==n.operation||"RESERVED"==n.operation?alert("Transaksjonen er fullført, du får en kvittering på epost"):"CANCEL"==n.operation?alert("Transaksjonen er kansellert"):alert("Noe gikk skeis..."),window.location.href=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.add_contact"},!1))}))}}(),$((function(){$("#btnValidate").on("click",(function(e){s(e)&&n()})),$("#btnSubmit").on("click",(function(e){s(e)&&n().then((()=>{$("#application_form").submit()}))}))}))}))})()})();