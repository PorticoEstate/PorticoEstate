(()=>{var e={940:()=>{if(!globalThis.trans){globalThis.translations=ko.observable({});const e=phpGWLink("bookingfrontend/lang.php",null,!0);fetch(e).then((e=>e.json())).then((e=>globalThis.translations(e))),globalThis.trans=(e,t,...n)=>{const o=globalThis.translations(),a=e=>o[e]&&o[e][t]?o[e][t].replace(/%\d+/g,(e=>{const t=parseInt(e.substring(1))-1;return void 0!==n[t]?n[t]:e})):null;if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=a(e[t]);if(null!==n)return n}else{const t=a(e);if(null!==t)return t}if(!Array.isArray(e)||!e.includes("common")){const e=a("common");if(null!==e)return e}return`Missing translation for [${Array.isArray(e)?e.join(", "):e}][${t}]`};class t{constructor(e,t){let n=t.templateNodes.map((e=>e.textContent));1===n.length&&n[0].includes(":")&&(n=n[0].split(":")),n=n.map((e=>e.trim())),n.length>=2?(this.tag=ko.observable(n[1]),this.group=ko.observable(n[0])):(this.tag="function"==typeof e.tag?e.tag:ko.observable(e.tag),this.group="function"==typeof e.group?e.group:ko.observable(e.group)),this.suffix=ko.observable(e.suffix||""),this.args=ko.observable(e.args),this.translations=globalThis.translations,this.translated=ko.computed((()=>{if(self.translations&&self.translations()&&Object.keys(self.translations()).length>0&&this.group&&this.tag)return globalThis.trans(this.group(),this.tag(),this.args())+this.suffix()}))}}ko.components.register("trans",{viewModel:{createViewModel:function(e,n){return new t(e,n)}},template:"\x3c!--ko text: translated()--\x3e\x3c!--/ko--\x3e"})}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{"use strict";function e(e,t={},n=!1){var o=strBaseURL.split("?")[0]+e+"?";return Object.entries(t).forEach((([e,t])=>{o+=`${encodeURIComponent(e)}=${encodeURIComponent(t)}&`})),n&&(o+="phpgw_return_as=json&"),o.slice(0,-1)}n(940),$(document).ready((function(){$("input[type=radio][name=select_template]").change((function(){var t=$(this).val(),n=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{template_set:t},url:n,success:function(e){location.reload(!0)}})})),$("input[type=radio][name=select_language]").change((function(){var t=$(this).val(),n=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{lang:t},url:n,success:function(e){location.reload(!0)}})}))}));let t=new class{constructor(){this.applicationCartItems=ko.observableArray([]),this.applicationCartItemsEmpty=ko.observable(!1),this.visible=ko.observable(!0),this.initializeCart()}initializeCart(){this.getApplicationsCartItems()}deleteItem(t){console.log("got delete request");const n=e("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.delete_partial"},!0);confirm("Do you want to delete this application?")&&fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then((e=>e.json())).then((()=>this.getApplicationsCartItems())).catch((e=>console.error("Error:",e)))}getApplicationsCartItems(){const t=e("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.get_partials"},!0);fetch(t).then((e=>e.json())).then((e=>this.updateCartItems(e))).catch((e=>console.error("Error fetching cart items:",e)))}updateCartItems(e){const{list:t,total_sum:n}=e;n&&(document.getElementById("total_sum").textContent=n.toFixed(2),document.getElementById("total_sum_block").style.display="block"),this.applicationCartItemsEmpty(t.length<1),this.applicationCartItems(t.map((e=>({...e,dates:e.dates.map((e=>{const t=new Date(e.from_.replace(" ","T"));t.setHours(e.from_.substring(11,13)),t.setMinutes(e.from_.substring(14,16));const n=new Date(e.to_.replace(" ","T"));return n.setHours(e.to_.substring(11,13)),n.setMinutes(e.to_.substring(14,16)),{date:formatSingleDateWithoutHours(t),from_:e.from_,to_:e.to_,periode:formatPeriodeHours(t,n)}})),resources:ko.observableArray(e.resources.map((e=>({...e})))),joinedResources:e.resources.map((e=>e.name)).join(", ")}))))}};var o;o=()=>{document.getElementById("applications-cart-content")&&(console.log("INITIALISING CART"),ko.applyBindings(t,document.getElementById("application-cart-container")))},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(o,1):document.addEventListener("DOMContentLoaded",o),$(".navbar-search").removeClass("d-none"),document.location.origin,window.location.pathname.split("/")[1],CreateUrlParams(window.location.search),ko.validation.locale("nb-NO");class a{constructor(){this.isFormVisible=ko.observable(!0);const e=document.getElementById("customer_identifier_type_hidden_field").value;this.typeApplicationRadio=ko.observable(e||"ssn"),this.applicationCartItems=ko.computed((()=>(console.log(t.applicationCartItems()),t.applicationCartItems()))),this.applicationCartItemsEmpty=ko.computed((()=>{t.applicationCartItemsEmpty()&&(window.location.href=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uisearch.index"},!1))})),this.typeApplicationRadio.subscribe((e=>console.log(e))),this.typeApplicationSelected=ko.computed((()=>"undefined"!==this.typeApplicationRadio()&&null!==this.typeApplicationRadio())),this.typeApplicationValidationMessage=ko.observable(!1),this.applicationSuccess=ko.observable(!1)}deleteItem(e){t.deleteItem(e)}}function i(e){var t=!1,n=$("#application_form")[0],o=n.checkValidity();if(!o){var a=n.querySelectorAll(":invalid");for(var i of a)console.log(i),i.setAttribute("style","background-color: red;")}return o||(t=!0,e.preventDefault(),e.stopPropagation()),document.getElementById("contact_email2").value!==document.getElementById("contact_email").value?(document.getElementById("contact_email2").classList.replace("valid","invalid"),t=!0,alert("Epostadressen er ikke den samme i begge feltene")):document.getElementById("contact_email2").classList.replace("invalid","valid"),n.classList.add("was-validated"),!t||(alert("Fyll ut alle obligatoriske felt"),!1)}$(document).ready((function(){var e=new a;ko.applyBindings(e,document.getElementById("new-application-partialtwo")),t.visible(!1);var n=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiorganization.get_organization_list"},!0);function o(){var e=$("#application_form");$('<div id="spinner" class="text-center mt-2  ml-2">').append($('<div class="spinner-border" role="status">').append($('<span class="sr-only">Processing...</span>'))).insertAfter(e);var t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.update_contact_informtation"},!0),n=e.serializeArray();$.ajax({cache:!1,type:"POST",dataType:"json",url:t,data:n,success:function(e,t,n){if(e){"saved"!==e.status?(alert(e.message),window.location.reload()):(""!==$("#total_sum").text()&&0!=e.direct_booking||($("#external_payment_method").hide(),$("#btnSubmit").text(lang.Send)),e.contact_info.responsible_street&&$("#field_responsible_street").val(e.contact_info.responsible_street),e.contact_info.responsible_zip_code&&$("#field_responsible_zip_code").val(e.contact_info.responsible_zip_code),e.contact_info.responsible_city&&$("#field_responsible_city").val(e.contact_info.responsible_city));var o=document.getElementById("spinner");o&&o.parentNode.removeChild(o)}}})}$("#customer_organization_number").select2({ajax:{url:n,dataType:"json",delay:250,data:function(e){return{query:e.term,page:e.page||1}},cache:!0},width:"100%",placeholder:"Søk etter din organisasjon/bedrift med navn eller organisasjonsnummer",minimumInputLength:2,language:"no",allowClear:!0}),$("#customer_organization_number").on("select2:open",(function(e){$(".select2-search__field").each((function(){"select2-customer_organization_number-results"==$(this).attr("aria-controls")&&$(this)[0].focus()})),$("input[name='customer_organization_number_fallback']").prop("readonly",!0),$("input[name='customer_organization_name']").prop("readonly",!0)})),$("#customer_organization_number").on("select2:select",(function(e){var t=e.params.data;$("input[name='customer_organization_number_fallback']").val(t.organization_number),$("input[name='customer_organization_name']").val(t.name)})),$("#customer_organization_number").on("select2:clear",(function(e){$("input[name='customer_organization_number_fallback']").prop("readonly",!0),$("input[name='customer_organization_number_fallback']").val(""),$("input[name='customer_organization_name']").prop("readonly",!0),$("input[name='customer_organization_name']").val(""),$("#customer_organization_number").prop("required",!0)})),function(){if(payment_order_id){var e=selected_payment_method,t=document.getElementById("new-application-partialtwo");t.style.display="none",$('<div id="spinner" class="text-center mt-2  ml-2">').append($('<div class="spinner-border" role="status">').append($('<span class="sr-only">Checking...</span>'))).insertAfter(t);var n={menuaction:"bookingfrontend."+e+"_helper.check_payment_status",payment_order_id},o=phpGWLink("bookingfrontend/",n,!0);$.getJSON(o,(function(e){var t=document.getElementById("spinner");t&&t.parentNode.removeChild(t),console.log(e);var n=e.transactionLogHistory[0];!0===n.operationSuccess&&("RESERVE"==n.operation||"RESERVED"==n.operation?alert("Transaksjonen er fullført, du får en kvittering på epost"):"CANCEL"==n.operation?alert("Transaksjonen er kansellert"):alert("Noe gikk skeis..."),window.location.href=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.add_contact"},!1))}))}}(),$((function(){$("#btnValidate").on("click",(function(e){i(e)&&o()})),$("#btnSubmit").on("click",(function(e){i(e)&&(o(),$("#application_form").submit())}))}))}))})()})();