(()=>{var e={696:()=>{$(document).ready((function(){$("input[type=radio][name=select_template]").change((function(){var e=$(this).val(),t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{template_set:e},url:t,success:function(e){location.reload(!0)}})})),$("input[type=radio][name=select_language]").change((function(){var e=$(this).val(),t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{lang:e},url:t,success:function(e){location.reload(!0)}})}))}))},16:()=>{ko.bindingHandlers.withAfterRender={init:function(e,t,n,o,i){var a=t();ko.applyBindingsToNode(e,{visible:!0},i),a.afterRender&&a.afterRender(e)}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(()=>{"use strict";n(16),ko.components.register("time-picker",{viewModel:function(e){const t=this;let n;t.selectedTime=e.selectedTime||ko.observable(""),t.placeholderText=e.placeholderText||"Choose time...",t.timeOptions=ko.observableArray(function(){let e=[];for(let t=0;t<24;t++)for(let n=0;n<60;n+=15){let o=t.toString().padStart(2,"0"),i=n.toString().padStart(2,"0");e.push(`${o}:${i}`)}return e}()),t.showDropdown=function(){n.style.display="block";const e=n.children[0].offsetHeight,o=t.selectedTime()||"14:30",i=ko.unwrap(t.timeOptions).indexOf(o);n.scrollTo({top:e*i})},t.hideDropdown=function(){n.style.display="none"},t.delayedHideDropdown=function(){setTimeout(t.hideDropdown,150)},t.selectTime=function(e){t.selectedTime(e),t.hideDropdown()},t.formatTime=function(){const e=t.selectedTime().match(/^(\d{1,2})(?:[.: ]*(\d{2}))?$/);if(e){const n=parseInt(e[1]),o=e[2]?parseInt(e[2]):0;n>=0&&n<24&&o>=0&&o<60?t.selectedTime(`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`):t.selectedTime("")}else t.selectedTime("")},t.afterRender=function(e){const o=e.querySelector(".timeInput");n=e.querySelector(".timeDropdown"),e.addEventListener("focus",t.showDropdown,!0),e.addEventListener("blur",t.delayedHideDropdown,!0),o.addEventListener("focus",t.showDropdown),o.addEventListener("blur",t.formatTime),n.addEventListener("click",(function(e){e.target.matches(".timeDropdown > div")&&t.selectTime(e.target.textContent)})),o.addEventListener("keydown",(function(e){13===e.keyCode&&(t.selectedTime(o.value),t.formatTime(),e.preventDefault())}))}},template:'\n\x3c!--  \t<div class="dropdownContainer"  data-bind="withAfterRender: { afterRender: $component.afterRender}">--\x3e\n\x3c!--        <input type="text" class="timeInput" placeholder="Choose time..." data-bind="value: selectedTime">--\x3e\n\x3c!--        <div class="timeDropdown" data-bind="foreach: timeOptions" style="display: none;">--\x3e\n\x3c!--            <div data-bind="text: $data, click: $component.selectTime"></div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </div>--\x3e\n<div class="dropdownContainer d-flex flex-column align-items-center align-self-stretch" data-bind="withAfterRender: { afterRender: $component.afterRender}">\n    <label class="input-icon w-100" aria-labelledby="input-text-icon">\n        <span class="far fa-clock icon" aria-hidden="true"></span>\n        <input type="text" \n               class="form-control bookingStartTime mr-2 timeInput" \n               placeholder="" \n               data-bind="value: selectedTime, attr: { placeholder: placeholderText }">\n        </input>\n    </label>\n    <div class="timeDropdown" style="display: none;" data-bind="foreach: timeOptions">\n        <div data-bind="text: $data, click: $component.selectTime, css: { \'active\': $data === $component.selectedTime() }"></div>\n    </div>\n</div>\n\n    '}),ko.components.register("map-modal",{viewModel:{createViewModel:function(e,t){return(e=>{let n=t.templateNodes.map((e=>e.textContent));1===n.length&&n[0].includes("\n")&&(n=n[0].split("\n")),n=n.map((e=>{return(t=e.trim()).endsWith(",")&&(t=t.slice(0,-1)),t;var t})),self.mapParts=ko.observableArray(n),self.randomHash=ko.observable(function(e=8){return Array.from({length:e},(()=>Math.floor(36*Math.random()).toString(36))).join("")}()),self.descriptionExpanded=ko.observable(!1),self.toggleDescription=()=>{self.descriptionExpanded(!self.descriptionExpanded())},self.shortPath=ko.computed((()=>self.mapParts().slice(0,2).join(", "))),self.longPath=ko.computed((()=>`https://maps.google.com/maps?f=q&source=s_q&hl=no&output=embed&geocode=&q=${self.mapParts().join(",")}`)),self.openModal=()=>{$("#mapModal"+randomHash()).modal("show")},self.closeModal=()=>{$("#mapModal"+randomHash()).modal("hide")}})()}},template:'\n        <button type="button" class="pe-btn pe-btn--transparent link-text link-text-secondary p-0"\n                data-bind="click: function() { openModal() }">\n            <div class="text-primary d-flex gap-1 align-items-center">\n                <i class="fa-solid fa-map-pin" style="font-size: 1rem"></i>\n                <span data-bind="text: shortPath"></span>\n            </div>\n        </button>\n\n        <div class="modal fade" data-bind="attr: {id: \'mapModal\' + randomHash()}" tabindex="-1"\n             aria-labelledby="mapModal"\n             aria-hidden="true">\n            <div class="modal-dialog modal-xl" style="height: 100%">\n                <div class="modal-content" style="height: 80%;">\n                    <div class="modal-header border-0">\n                        <button type="button" class="btn-close text-grey-light" data-bs-dismiss="modal"\n                                aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body d-flex justify-content-center pt-0 pb-4">\n                        <div style="display: flex; justify-content: center; align-items: stretch; width: 100%;">\n                            <iframe id="iframeMap" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"\n                                    style="width: 100%;" data-bind="attr:{src: longPath()}">\n                            </iframe>\n                        </div>\n                        <br/>\n\n                    </div>\n                </div>\n            </div>\n        </div>\n    '}),n(696),$(".navbar-search").removeClass("d-none"),document.location.origin,window.location.pathname.split("/")[1],$(".maleInput").attr("data-bind","textInput: inputCountMale, attr: {'name': malename }"),$(".femaleInput").attr("data-bind","textInput: inputCountFemale, attr: {'name': femalename }");var e,t=CreateUrlParams(window.location.search),o=ko.observable({});ko.validation.locale("nb-NO");var i=[];function a(){var e=this;e.showErrorMessages=ko.observable(!1),document.getElementById("applications-cart-content")&&(e.applicationCartItems=ko.computed((function(){return bc.applicationCartItems()}))),e.formStep=ko.observable(0),e.bookingDate=ko.observable(""),e.bookingStartTime=ko.observable(""),e.bookingEndTime=ko.observable(""),e.goNext=()=>{e.formStep(e.formStep()+1),window.scrollTo({top:0,behavior:"smooth"})},e.goPrev=()=>{e.formStep(e.formStep()-1),window.scrollTo({top:0,behavior:"smooth"})},e.formatDate=function(e){const t=luxon.DateTime.fromFormat(e.from_,"dd/MM/yyyy HH:mm");return t.day+". "+["jan","feb","mar","apr","mai","jun","jul","aug","sep","okt","nov","des"][t.month-1]},e.formatTimePeriod=function(e){return e.from_.split(" ")[1]+"-"+e.to_.split(" ")[1]},e.bookableResource=ko.observableArray(),e.selectedResourcesOld=ko.observableArray(0),e.isResourceSelected=ko.computed((function(){for(var n=[],o=0,a=0;a<e.bookableResource().length;a++)e.bookableResource()[a].selected()?(n.push(e.bookableResource()[a].id),e.selectedResourcesOld.indexOf(e.bookableResource()[a].id)<0&&e.selectedResourcesOld.push(e.bookableResource()[a].id),o++):e.selectedResourcesOld.indexOf(e.bookableResource()[a].id)>-1&&e.selectedResourcesOld.splice(e.selectedResourcesOld.indexOf(e.bookableResource()[a].id),1);if(o>0){var l=n,s=i;return!(l.length!=s.length||!l.every((function(e,t){return e===s[t]})))||(i=n,$("#regulation_documents").empty(),function(e){for(var n={menuaction:"bookingfrontend.uidocument_view.regulations","owner[]":"building::"+t.building_id,sort:"name"},o=phpGWLink("bookingfrontend/",n,!0),i=0;i<e.length;i++)o+="&owner[]=resource::"+e[i];$.getJSON(o,(function(e){r(e.data)}))}(n),"function"!=typeof populateTableChkArticles||(populateTableChkArticles([],n,"","",""),!0))}return!1})).extend({required:!0}),e.audiences=ko.observableArray(),e.audienceSelectedValue=ko.observable(),e.activityId=ko.observable(),e.date=ko.observableArray(),e.addDate=function(){if(e.bookingDate()&&e.bookingStartTime()&&e.bookingEndTime()){let r=e.bookingDate(),l=r.split(".");1===l[0].length&&(l[0]="0"+l[0],r=l.join(".")),1===l[1].length&&(l[1]="0"+l[1],r=l.join("."));let s=luxon.DateTime.fromFormat(r,"dd.MM.yyyy");var t=e.bookingStartTime().split(":"),n=e.bookingEndTime().split(":"),o=s.set({hour:parseInt(t[0]),minute:parseInt(t[1])}),i=s.set({hour:parseInt(n[0]),minute:parseInt(n[1])}),a=luxon.DateTime.local();o<a||i<a?$(".applicationSelectedDates").html("Tidspunktet må være i fremtiden"):o>=i?$(".applicationSelectedDates").html("Starttid må være tidligere enn sluttid"):ko.utils.arrayFirst(e.date(),(function(e){return e.id===[o.toISO(),i.toISO()].join("")}))||(e.date.push({id:[o.toISO(),i.toISO()].join(""),from_:o.toFormat("dd/MM/yyyy HH:mm"),to_:i.toFormat("dd/MM/yyyy HH:mm"),formatedPeriode:o.toFormat("dd/MM/yyyy HH:mm")+" - "+i.toFormat("HH:mm")}),setTimeout((function(){e.bookingDate(""),e.bookingStartTime(""),e.bookingEndTime(""),$(".applicationSelectedDates").html(""),"function"==typeof post_handle_order_table&&post_handle_order_table()}),500))}},e.removeDate=function(){e.date.remove(this),"function"==typeof post_handle_order_table&&setTimeout((function(){post_handle_order_table()}),500)},e.removeRessource=function(){this.selected(!1)},e.aboutArrangement=ko.observable(""),e.agegroupList=ko.observableArray(),e.specialRequirements=ko.observable(""),e.attachment=ko.observable(),e.selectedResourcesWithFacilities=ko.computed((function(){for(var t=ko.utils.arrayFilter(e.bookableResource(),(function(e){return e.selected()})),n=[],i=0;i<t.length;i++){var a=o()[t[i].id.toString()]||[];n.push({resourceName:t[i].name,facilities:a})}return n})),e.selectedResourcesOld.subscribe((function(t){e.bookableResource().forEach((function(e){var n=t.includes(e.id);$(`#select2-select-multiple-results [id*='${e.id}']`),$(this).attr("aria-selected","false"),$(this).attr("aria-fake-selected",n?"true":"false")}))})),$(document).ready((function(){var t=$("#select-multiple"),n=$(".selected-items-display");console.log(n),t.select2({theme:"select-v2",width:"100%",placeholder:"Velg leieobjekt",closeOnSelect:!1});const o=()=>{$(".select2-results__option[id^='select2-select-multiple-result-']").each((function(){var t=this.id.split("-");const n=t[t.length-1];console.log(n);var o=e.selectedResourcesOld().includes(+n);$(this).attr("aria-selected","false"),$(this).attr("aria-fake-selected",o?"true":"false")}))};function i(t){var n=t.params.data;console.log("Item selected/unselected: ",+n.id);var i=e.bookableResource().find((function(e){return e.id===+n.id}));console.log(e.bookableResource()),console.log(i),i&&i.selected(!i.selected()),console.log($(this)),$(this).val(null).trigger("change"),setTimeout((function(){o()}),0)}t.on("select2:open",(function(){setTimeout((function(){o()}),0)})),t.on("select2:select",i),t.on("select2:unselect",i)}))}function r(e){for(var t,n="",o=0;o<e.length;o++)t="",null!=initialAcceptedDocs&&initialAcceptedDocs[o]==e[o].id&&(t=' checked= "checked"'),n+='<div class="col-12 mb-4">',n+='<label class="choice">',n+='<input name="accepted_documents[]" value="'+e[o].id+'" type="checkbox"'+t+">",n+='<a class="d-inline termAcceptDocsUrl" target="_blank"  href="'+RemoveCharacterFromURL(e[o].link,"amp;")+'">'+e[o].name+"</a>",n+='<span class="choice__check">',n+="</span>",n+="</label>",n+="</div>";$("#regulation_documents").html(n)}console.log(ko.version),console.log("Registering component"),$(document).ready((function(){var n;void 0===t.building_id&&(t.building_id=building_id),e=new a;let i=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.add",building_id:t.building_id,phpgw_return_as:"json"},!0);$.getJSON(i,(function(a){n=a.application.activity_id;for(var l=0;l<a.agegroups.length;l++)e.agegroupList.push({name:a.agegroups[l].name,agegroupLabel:a.agegroups[l].name,inputCountMale:ko.observable("").extend({number:!0}),inputCountFemale:ko.observable("").extend({number:!0}),malename:"male["+a.agegroups[l].id+"]",femalename:"female["+a.agegroups[l].id+"]",id:a.agegroups[l].id});if(null!=initialAgegroups)for(l=0;l<initialAgegroups.length;l++){var s=initialAgegroups[l].agegroup_id,d=ko.utils.arrayFirst(e.agegroupList(),(function(e){return e.id==s}));d&&(d.inputCountMale(initialAgegroups[l].male),d.inputCountFemale(initialAgegroups[l].female))}for(l=0;l<a.audience.length;l++)$.inArray(a.audience[l].id,initialAudience)>-1&&$("#audienceDropdownBtn").text(a.audience[l].name),e.audiences.push({id:a.audience[l].id,name:a.audience[l].name});i=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiresource.index_json",filter_building_id:t.building_id,sort:"name",phpgw_return_as:"json"},!0),$.getJSON(i,(function(n){for(var i=0;i<n.results.length;i++){var a=n.results[i];if(1!==a.deactivate_application&&a.building_id==t.building_id){var r=!1;$.inArray(a.id,initialSelection)>-1&&(r=!0),void 0!==t.resource_id&&0==initialSelection.length&&t.resource_id==a.id&&(r=!0);var l=a.name,s=Math.floor(Date.now()/1e3);a.simple_booking&&a.simple_booking_start_date<s||1==a.hidden_in_frontend?l+=" *":(a.direct_booking&&a.direct_booking<s&&(l+=" *"),e.bookableResource.push({id:a.id,name:l,selected:ko.observable(r)}))}if(a.facilities_list&&Array.isArray(a.facilities_list)){var d=a.id.toString();o()[d]||(o()[d]=[]);for(var c=0;c<a.facilities_list.length;c++)o()[d].push(a.facilities_list[c])}}o.valueHasMutated()}));var c={menuaction:"bookingfrontend.uidocument_view.regulations","owner[]":"building::"+t.building_id,sort:"name"};for(i=phpGWLink("bookingfrontend/",c,!0),l=0;l<initialSelection.length;l++)i+="&owner[]=resource::"+initialSelection[l];$.getJSON(i,(function(e){r(e.data)}))})).done((function(){e.activityId(n),console.log("Applying bindings"),ko.applyBindings(e,document.getElementById("new-application-page")),function(){if(null!=initialDates)for(var n=0;n<initialDates.length;n++){var o=initialDates[n].from_.replace(" ","T"),i=initialDates[n].to_.replace(" ","T");e.date.push({from_:formatDateToDateTimeString(new Date(o)),to_:formatDateToDateTimeString(new Date(i)),formatedPeriode:formatDate(new Date(o),new Date(i))})}else void 0!==t.start&&void 0!==t.end&&t.start.length>0&&t.end.length>0&&e.date.push({from_:formatDateToDateTimeString(new Date(parseInt(t.start))),to_:formatDateToDateTimeString(new Date(parseInt(t.end))),formatedPeriode:formatDate(new Date(parseInt(t.start)),new Date(parseInt(t.end)))})}(),function(){if(void 0!==t.fromDate){let n=new Date(t.fromDate);e.bookingDate(n);let o=new Intl.DateTimeFormat("en",{year:"numeric"}).format(n),i=new Intl.DateTimeFormat("en",{month:"2-digit"}).format(n),a=new Intl.DateTimeFormat("en",{day:"2-digit"}).format(n);$(".datepicker-btn").val(`${a}/${i}/${o}`)}}(),"undefined"!=typeof initialAudience&&e.audienceSelectedValue(initialAudience)})),$(".resourceDropdown").on("click",(function(){$(this).parent().toggleClass("show")})),$("#application_form").submit((function(e){var t;t=0,$('#regulation_documents input[name="accepted_documents[]"]').each((function(){$(this).is(":checked")||t++})),0==t||(alert(errorAcceptedDocs),e.preventDefault())}))})),new Date;const l=document.getElementById("field_name_input"),s=document.getElementById("field_name"),d=document.getElementById("attachment-remove"),c=document.getElementById("attachment"),u=document.getElementById("attachment-upload");function m(e,t){const n=document.createElement("div");n.className="alert "+t,n.appendChild(document.createTextNode(e)),c.insertBefore(n,u),d.className="isDisabled",u.className="isDisabled",setTimeout((function(){document.querySelector(".alert").remove(),d.classList.remove("isDisabled"),u.classList.remove("isDisabled")}),2500)}s&&(s.addEventListener("change",(function(){""===s.value&&""===s.textContent||(d.style.display="block")})),document.getElementById("field_name").onchange=function(){var e=!1,t=this.value,n=this.accept;if(t){var o=t.split(/(\\|\/)/g).pop();$("#field_name_input").empty().append(o);var i="."+o.split(".").pop();const a=new RegExp(i);n.match(a)||(e=!0,m("Ugyldig filtype!","alert-danger"))}s.files[0].size>2e6&&(e=!0,m("Filen er for stor!","alert-danger")),e&&(l.textContent="",s.value="",d.style.display="none")},d.addEventListener("click",(function(){""===l.textContent&&""===s.value||(m("Vedlegg fjernet!","alert-success"),l.textContent="",s.value="",d.style.display="none")}))),window.onload=function(){const t=document.getElementById("submit-error"),n=document.getElementById("inputEventName"),o=document.getElementById("inputOrganizerName"),i=document.getElementById("inputTargetAudience");if(!n)return void console.error("inputEventName missing!");if(!t)return void console.error("submit-error missing!");if(!o)return void console.error("inputOrganizerName missing!");if(!i)return void console.error("inputTargetAudience missing!");let a=[n,o];for(let e=0;e<a.length;e++)a[e].addEventListener("input",(function(e){e.target.value?(e.target.classList.remove("is-invalid"),e.target.classList.add("is-valid")):(e.target.classList.add("is-invalid"),e.target.classList.remove("is-valid"))}));form.addEventListener("submit",(function(a){e.bookingDate()&&e.bookingStartTime()&&e.bookingEndTime()&&(e.date().some((function(t){return t.from_===e.bookingDate()&&t.to_===e.bookingStartTime()&&t.formatedPeriode===e.bookingEndTime()}))||e.addDate()),n.value&&o.value&&i.value||(a.preventDefault(),a.stopPropagation(),n.value?n.classList.replace("is-invalid","is-valid")||n.classList.add("is-valid"):n.classList.add("is-invalid"),o.value?o.classList.replace("is-invalid","is-valid")||o.classList.add("is-valid"):o.classList.add("is-invalid"),function(){const e=document.getElementById("audienceDropdown");e.value?e.classList.add("is-valid"):e.classList.add("is-invalid")}(),t.style.display="block",setTimeout((function(){t.style.display="none"}),5e3))}))}})()})();