(()=>{var e={880:()=>{function e(e){if(/^\d{2}\/\d{2}\/\d{4} \d{2}:\d{2}$/.test(e))return e;if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(e)){const[t,n]=e.split(" "),[o,i,a]=t.split("-"),[s,r]=n.split(":");return`${a}/${i}/${o} ${s}:${r}`}throw new Error("Invalid date format")}ko.components.register("time-slot-pill",{viewModel:function(t){const n=this;n.schedule=t.schedule,n.selectedResources=t.selectedResources,console.log(t),n.date=t.date,n.options={hour:"2-digit",minute:"2-digit"},console.log(n.date),n.startTime=ko.computed((()=>luxon.DateTime.fromFormat(e(n.date.from_),"dd/MM/yyyy HH:mm").toJSDate())),n.endTime=ko.computed((()=>luxon.DateTime.fromFormat(e(n.date.to_),"dd/MM/yyyy HH:mm").toJSDate())),n.toDateStr=e=>`${e.getDate()}. ${monthNamesShort[e.getMonth()].toLowerCase()}`,n.toTimeStr=(e,t)=>t?`${e.toLocaleTimeString("no",n.options).replace(":",".")} -\n                ${t.toLocaleTimeString("no",n.options).replace(":",".")}`:e.toLocaleTimeString("no",n.options).replace(":","."),n.removeDate=t.removeDate,n.error=ko.computed((()=>{if(!n.schedule||!n.selectedResources)return!1;const e={date:luxon.DateTime.fromJSDate(n.startTime()).toFormat("yyyy-MM-dd"),from:luxon.DateTime.fromJSDate(n.startTime()).toFormat("HH:mm:ss"),to:luxon.DateTime.fromJSDate(n.endTime()).toFormat("HH:mm:ss"),resources:n.selectedResources()},t=n.schedule().find((t=>function(e,t){if(e.date!==t.date)return!1;if("allocation"===t.type||"booking"===t.type)return!1;const n=e.from<t.to&&e.to>t.from,o=e.resources.some((e=>t.resources.some((t=>e.id===t.id))));return n&&o}(e,t)));return t?`${e.resources.find((e=>t.resources.some((t=>t.id===e.id)))).name} ikke tilgjengelig`:void 0}))},template:'\n\n        <div class="pill pill--secondary" data-bind="css: {\'pill--error\': error}">\n            \x3c!-- ko if: startTime().getMonth() === endTime().getMonth() && startTime().getFullYear() === endTime().getFullYear() && startTime().getDate() === endTime().getDate() --\x3e\n            <div class="pill-label">\n                <span className="text-primary text-bold" data-bind="text: toDateStr(startTime())"></span>\n            </div>\n            <div class="pill-divider"></div>\n            <div class="pill-time"\n                 data-bind="text: toTimeStr(startTime(), endTime()), css: {\'last-child\': !removeDate}">\n\n            </div>\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko ifnot: (startTime().getMonth() === endTime().getMonth() && startTime().getFullYear() === endTime().getFullYear() && startTime().getDate() === endTime().getDate()) --\x3e\n            <div class="pill-content gap-1">\n                <div class="date"><span class="text-primary text-bold" data-bind="text: toDateStr(startTime())"></span>\n                    <span data-bind="text: toTimeStr(startTime())"></span>\n                </div>\n                <span> - </span>\n                <div class="time"><span class="text-primary text-bold" data-bind="text: toDateStr(endTime())"></span>\n                    <span data-bind="text: toTimeStr(endTime())"></span>\n                </div>\n            </div>\n\n            \x3c!-- /ko --\x3e\n\n            \x3c!-- ko if: !!removeDate --\x3e\n            <button class="pill-icon" data-bind="click: removeDate"><i class="pill-cross"></i></button>\n            \x3c!-- /ko --\x3e\n\n        </div>\n        \x3c!-- ko if: error --\x3e\n        <div class="d-flex align-items-center gap-2">\n            <svg class="font-size-small" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M6.00011 0.75C6.33292 0.75 6.63996 0.925781 6.80871 1.21406L11.8712 9.83906C12.0423 10.1297 12.0423 10.4883 11.8759 10.7789C11.7095 11.0695 11.3978 11.25 11.0626 11.25H0.937611C0.602455 11.25 0.290736 11.0695 0.12433 10.7789C-0.042076 10.4883 -0.0397323 10.1273 0.129018 9.83906L5.19152 1.21406C5.36027 0.925781 5.6673 0.75 6.00011 0.75ZM6.00011 3.75C5.68839 3.75 5.43761 4.00078 5.43761 4.3125V6.9375C5.43761 7.24922 5.68839 7.5 6.00011 7.5C6.31183 7.5 6.56261 7.24922 6.56261 6.9375V4.3125C6.56261 4.00078 6.31183 3.75 6.00011 3.75ZM6.75011 9C6.75011 8.80109 6.67109 8.61032 6.53044 8.46967C6.38979 8.32902 6.19902 8.25 6.00011 8.25C5.8012 8.25 5.61043 8.32902 5.46978 8.46967C5.32913 8.61032 5.25011 8.80109 5.25011 9C5.25011 9.19891 5.32913 9.38968 5.46978 9.53033C5.61043 9.67098 5.8012 9.75 6.00011 9.75C6.19902 9.75 6.38979 9.67098 6.53044 9.53033C6.67109 9.38968 6.75011 9.19891 6.75011 9Z"\n                      fill="#B00020"/>\n            </svg>\n            <span class="text-small text-red-error" data-bind="text: error"></span>\n        </div>\n        \x3c!-- /ko --\x3e\n    '})},940:()=>{if(!globalThis.trans){globalThis.translations=ko.observable({}),globalThis.translationsLoaded=ko.observable(!1);const e=phpGWLink("bookingfrontend/lang.php",null,!0);fetch(e).then((e=>e.json())).then((e=>{globalThis.translations(e),globalThis.translationsLoaded(!0)})),globalThis.trans=(e,t,...n)=>{const o=globalThis.translations(),i=e=>o[e]&&o[e][t]?o[e][t].replace(/%\d+/g,(e=>{const t=parseInt(e.substring(1))-1;return void 0!==n[t]?n[t]:e})):null;if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=i(e[t]);if(null!==n)return n}else{const t=i(e);if(null!==t)return t}if(!Array.isArray(e)||!e.includes("common")){const e=i("common");if(null!==e)return e}return`Missing translation for [${Array.isArray(e)?e.join(", "):e}][${t}]`};class t{constructor(e,t){let n=t.templateNodes.map((e=>e.textContent));1===n.length&&n[0].includes(":")&&(n=n[0].split(":")),n=n.map((e=>e.trim())),n.length>=2?(this.tag=ko.observable(n[1]),this.group=ko.observable(n[0])):(this.tag="function"==typeof e.tag?e.tag:ko.observable(e.tag),this.group="function"==typeof e.group?e.group:ko.observable(e.group)),this.suffix=ko.observable(e.suffix||""),this.args=ko.observable(e.args),this.translations=globalThis.translations,this.translated=ko.computed((()=>{if(self.translations&&self.translations()&&Object.keys(self.translations()).length>0&&this.group&&this.tag)return globalThis.trans(this.group(),this.tag(),this.args())+this.suffix()}))}}ko.components.register("trans",{viewModel:{createViewModel:function(e,n){return new t(e,n)}},template:"\x3c!--ko text: translated()--\x3e\x3c!--/ko--\x3e"})}},16:()=>{ko.bindingHandlers.withAfterRender={init:function(e,t,n,o,i){var a=ko.unwrap(t());ko.applyBindingsToNode(e,{visible:!0},i),a&&a.afterRender&&a.afterRender.call(o,e)}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(()=>{"use strict";function e(e,t,n,o){if(o){const e=o.split("/").filter((e=>""!==e&&!e.includes("http")));o="//"+e.slice(0,e.length-1).join("/")+"/"}const i=(o||strBaseURL).split("?");let a=i[0]+e+"?";null==t&&(t=new Object);for(const e in t)a+=e+"="+t[e]+"&";return i[1]&&(a+=i[1]),n&&(a+="&phpgw_return_as=json"),a}n(16),ko.components.register("time-picker",{viewModel:function(e){const t=this;let n;t.selectedTime=e.selectedTime||ko.observable(""),t.placeholderText=e.placeholderText||"Choose time...",t.timeOptions=ko.observableArray(function(){let e=[];for(let t=0;t<24;t++)for(let n=0;n<60;n+=15){let o=t.toString().padStart(2,"0"),i=n.toString().padStart(2,"0");e.push(`${o}:${i}`)}return e}()),t.showDropdown=function(){n.style.display="block";const e=n.children[0].offsetHeight,o=t.selectedTime()||"14:30",i=ko.unwrap(t.timeOptions).indexOf(o);n.scrollTo({top:e*i})},t.hideDropdown=function(){n.style.display="none"},t.delayedHideDropdown=function(){setTimeout(t.hideDropdown,150)},t.selectTime=function(e){t.selectedTime(e),t.hideDropdown()},t.formatTime=function(){const e=t.selectedTime().match(/^(\d{1,2})(?:[.: ]*(\d{2}))?$/);if(e){const n=parseInt(e[1]),o=e[2]?parseInt(e[2]):0;n>=0&&n<24&&o>=0&&o<60?t.selectedTime(`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`):t.selectedTime("")}else t.selectedTime("")},t.afterRender=function(e){const o=e.querySelector(".timeInput");n=e.querySelector(".timeDropdown"),e.addEventListener("focus",t.showDropdown,!0),e.addEventListener("blur",t.delayedHideDropdown,!0),o.addEventListener("focus",t.showDropdown),o.addEventListener("blur",t.formatTime),n.addEventListener("click",(function(e){e.target.matches(".timeDropdown > div")&&t.selectTime(e.target.textContent)})),o.addEventListener("keydown",(function(e){13===e.keyCode&&(t.selectedTime(o.value),t.formatTime(),e.preventDefault())}))}},template:'\n\x3c!--  \t<div class="dropdownContainer"  data-bind="withAfterRender: { afterRender: $component.afterRender}">--\x3e\n\x3c!--        <input type="text" class="timeInput" placeholder="Choose time..." data-bind="value: selectedTime">--\x3e\n\x3c!--        <div class="timeDropdown" data-bind="foreach: timeOptions" style="display: none;">--\x3e\n\x3c!--            <div data-bind="text: $data, click: $component.selectTime"></div>--\x3e\n\x3c!--        </div>--\x3e\n\x3c!--    </div>--\x3e\n<div class="dropdownContainer d-flex flex-column align-items-center align-self-stretch" data-bind="withAfterRender: { afterRender: $component.afterRender}">\n    <label class="input-icon w-100" aria-labelledby="input-text-icon">\n        <span class="far fa-clock icon" aria-hidden="true"></span>\n        <input type="text" \n               class="form-control bookingStartTime mr-2 timeInput" \n               placeholder="" \n               data-bind="value: selectedTime, attr: { placeholder: placeholderText }">\n        </input>\n    </label>\n    <div class="timeDropdown" style="display: none;" data-bind="foreach: timeOptions">\n        <div data-bind="text: $data, click: $component.selectTime, css: { \'active\': $data === $component.selectedTime() }"></div>\n    </div>\n</div>\n\n    '}),n(880),ko.components.register("map-modal",{viewModel:{createViewModel:function(e,t){return(e=>{let n=t.templateNodes.map((e=>e.textContent));1===n.length&&n[0].includes("\n")&&(n=n[0].split("\n")),n=n.map((e=>{return(t=e.trim()).endsWith(",")&&(t=t.slice(0,-1)),t;var t})),self.mapParts=ko.observableArray(n),self.randomHash=ko.observable(function(e=8){return Array.from({length:e},(()=>Math.floor(36*Math.random()).toString(36))).join("")}()),self.descriptionExpanded=ko.observable(!1),self.toggleDescription=()=>{self.descriptionExpanded(!self.descriptionExpanded())},self.shortPath=ko.computed((()=>self.mapParts().slice(0,2).join(", "))),self.longPath=ko.computed((()=>`https://maps.google.com/maps?f=q&source=s_q&hl=no&output=embed&geocode=&q=${self.mapParts().join(",")}`)),self.openModal=()=>{$("#mapModal"+randomHash()).modal("show")},self.closeModal=()=>{$("#mapModal"+randomHash()).modal("hide")}})()}},template:'\n        <button type="button" class="pe-btn pe-btn-text-primary pe-btn-text pe-btn--transparent  p-0"\n                data-bind="click: function() { openModal() }">\n            <div class="d-flex gap-1 align-items-center">\n                <i class="fa-solid fa-map-pin" style="font-size: 1rem"></i>\n                <span class="text-label" data-bind="text: shortPath"></span>\n            </div>\n        </button>\n\n        <div class="modal fade" data-bind="attr: {id: \'mapModal\' + randomHash()}" tabindex="-1"\n             aria-labelledby="mapModal"\n             aria-hidden="true">\n            <div class="modal-dialog modal-xl" style="height: 100%">\n                <div class="modal-content" style="height: 80%;">\n                    <div class="modal-header border-0">\n                        <button type="button" class="btn-close text-grey-light" data-bs-dismiss="modal"\n                                aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body d-flex justify-content-center pt-0 pb-4">\n                        <div style="display: flex; justify-content: center; align-items: stretch; width: 100%;">\n                            <iframe id="iframeMap" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"\n                                    style="width: 100%;" data-bind="attr:{src: longPath()}">\n                            </iframe>\n                        </div>\n                        <br/>\n\n                    </div>\n                </div>\n            </div>\n        </div>\n    '}),n(940),$(document).ready((function(){$("input[type=radio][name=select_template]").change((function(){var t=$(this).val(),n=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{template_set:t},url:n,success:function(e){location.reload(!0)}})})),$("input[type=radio][name=select_language]").change((function(){var t=$(this).val(),n=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{lang:t},url:n,success:function(e){location.reload(!0)}})}))})),dateformat_backend.replace(/d/gi,"dd").replace(/m/gi,"mm").replace(/y/gi,"yyyy");class t{constructor(e){this.applicationCartItems=e.applicationCartItems,this.cartElementExpanded=ko.observable(!0),this.popperInstance=ko.observable(),this.isVisible=ko.observable(!1),this.deleteItem=e.deleteItem,this.applicationCartItems.subscribe((e=>console.log(e)))}initializePopper(e){const t=e.previousElementSibling;this.popperInstance(new Popper(t,e,{placement:"bottom-end",strategy:"fixed"}))}destroyPopperInstance(){this.popperInstance()&&(this.popperInstance().destroy(),this.popperInstance(null))}togglePopper(e=void 0){let t=this.popperInstance();t&&(this.isVisible(e||!this.isVisible()),t.update())}toggleCartExpansion(){this.cartElementExpanded(!this.cartElementExpanded())}popperAttr=ko.computed((()=>this.isVisible&&this.isVisible()?{"data-show":""}:{}))}ko.components.register("shopping-basket",{viewModel:{createViewModel:(e,n)=>new t(e,n)},template:'\n        <button class="pe-btn pe-btn--transparent menu__toggler" type="button" aria-expanded="false"\n                data-bind="click: () => togglePopper()">\n    <span class="text">\n        <i class="fa-solid fa-basket-shopping"></i>\n        <span class="badge badge-light" style="position: absolute;top: -5px;"\n              data-bind="visible: applicationCartItems().length > 0, text: applicationCartItems().length">-1\n        </span>\n    </span>\n        </button>\n        <div class="poppercontent"\n             style="z-index: 11"\n             data-bind="withAfterRender: {afterRender: (d) => initializePopper(d)}, visible: applicationCartItems().length > 0 && isVisible, attr: popperAttr()">\n            <div class="dialog-container">\n                <div class="dialog-header">\n                    <span class="dialog-title">Søknader klar for innsending</span>\n                    <button type="button" class="btn-close" data-bind="click: () => togglePopper(false)"\n                            aria-label="Close"></button>\n                </div>\n                <div class="dialog-ingress">\n                    <p>Her er en oversikt over dine søknader som er klar for innsending og godkjennelse.</p>\n                </div>\n                <div class="dialog-content">\n                    \x3c!-- Content goes here --\x3e\n                    <div class="article-table-wrapper" data-bind="visible: cartElementExpanded">\n                        <div data-bind="foreach: applicationCartItems">\n\n                            <div class="article-table-header title-only">\n                                <div class="resource-name d-flex gap-2 align-items-center">\n                                    <i class="fa-solid fa-location-dot"></i><h3 class="p-0 m-0" data-bind="text: building_name"></h3>\n                                </div>\n                                <div class="resource-expand float-right">\n                                    <span class="far fa-trash-alt mr-2" data-bind="click: () => $parent.deleteItem($data)"></span>\n                                </div>\n                            </div>\n                            <div class="category-table">\n\n                                    <div class="category-header category-article-row d-flex flex-wrap">\n                                        \x3c!-- ko foreach: { data: resources, as: \'item\' } --\x3e\n\n                                        <div class="pill pill">\n                                            <i class="fa-solid fa-layer-group"></i>\n                                            <div class="pill-label" data-bind="text: item.name"></div>\n                                        </div>\n                                        \x3c!-- /ko --\x3e\n\n                                    </div>\n\n                                <div class="category-articles">\n                                    <div class="category-article-row d-flex  flex-wrap">\n                                        \x3c!-- ko foreach: { data: dates, as: \'s\' } --\x3e\n                                        <time-slot-pill params="date: s"></time-slot-pill>\n                                        \x3c!-- /ko --\x3e\n\n                                    </div>\n                                </div>\n\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="dialog-actions">\n                    <a class="pe-btn pe-btn-primary pe-btn-colour-primary link-text link-text-white d-flex gap-3"\n                       data-bind="attr: { href: phpGWLink(\'bookingfrontend/\', {menuaction:\'bookingfrontend.uiapplication.add_contact\' }, false) } ">\n                        <div class="text-bold">\n                            <trans params="group: \'bookingfrontend\', tag:\'complete_applications\'"></trans>\n                        </div>\n                        <div class="text-bold d-flex align-items-center">\n                            <i class="fa-solid fa-arrow-right-long"></i>\n                        </div>\n                    </a>\n                </div>\n            </div>\n        </div>\n    '});let o=new class{constructor(){this.applicationCartItems=ko.observableArray([]),this.applicationCartItemsEmpty=ko.observable(!1),this.visible=ko.observable(!0),this.initializeCart()}initializeCart(){this.getApplicationsCartItems()}deleteItem(t){var n,o,i;console.log("got delete request",this,t),(n=trans("bookingfrontend","delete_rentobject"),o=trans("bookingfrontend","delete_rentobject_body"),i=[trans("bookingfrontend","cancel"),trans("bookingfrontend","delete")],new Promise(((e,t)=>{const a=document.createElement("dialog");a.className="options-dialog";const s=document.createElement("div");s.className="options-dialog-title",s.textContent=n,a.appendChild(s);const r=document.createElement("div");r.className="options-dialog-body",r.textContent=o,a.appendChild(r);const l=document.createElement("div");l.className="options-dialog-options",i.forEach(((e,t)=>{const n=document.createElement("button");n.textContent=e,n.className="pe-btn  pe-btn--transparent pe-btn-text-primary",n.onclick=()=>{a.close(t)},l.appendChild(n)})),a.appendChild(l),a.addEventListener("close",(()=>{a.returnValue?e(a.returnValue):t(new Error("Dialog closed without selection")),a.remove()})),document.body.appendChild(a),a.showModal()}))).then((n=>{if(1==+n){const n=e("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.delete_partial"},!0);fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then((e=>e.json())).then((()=>this.getApplicationsCartItems())).catch((e=>console.error("Error:",e)))}})).catch((e=>{}))}getApplicationsCartItems(){const t=e("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.get_partials"},!0);fetch(t).then((e=>e.json())).then((e=>this.updateCartItems(e))).catch((e=>console.error("Error fetching cart items:",e)))}updateCartItems(e){const{list:t,total_sum:n}=e;this.applicationCartItemsEmpty(t.length<1),this.applicationCartItems(t.map((e=>({...e,dates:e.dates.map((e=>{const t=new Date(e.from_.replace(" ","T"));t.setHours(e.from_.substring(11,13)),t.setMinutes(e.from_.substring(14,16));const n=new Date(e.to_.replace(" ","T"));return n.setHours(e.to_.substring(11,13)),n.setMinutes(e.to_.substring(14,16)),{date:formatSingleDateWithoutHours(t),from_:e.from_,to_:e.to_,periode:formatPeriodeHours(t,n)}})),resources:ko.observableArray(e.resources.map((e=>({...e})))),joinedResources:e.resources.map((e=>e.name)).join(", ")}))))}};var i;i=()=>{const e=document.getElementById("application-cart-container")||document.getElementById("applications-cart-content");e&&(console.log("INITIALISING CART"),ko.applyBindings(o,e))},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(i,1):document.addEventListener("DOMContentLoaded",i),$(".navbar-search").removeClass("d-none"),document.location.origin,window.location.pathname.split("/")[1],$(".maleInput").attr("data-bind","textInput: inputCountMale, attr: {'name': malename }"),$(".femaleInput").attr("data-bind","textInput: inputCountFemale, attr: {'name': femalename }");var a,s=function(e){var t=window.location.search.split("&");let n=[];for(var o=0;o<t.length;o++){var i=t[o].split("=");n[i[0]]=i[1]}return n}(),r=ko.observable({});ko.validation.locale("nb-NO");var l=[];function d(){var e=this;function t(e,t){let n=document.getElementById(e);if(n){n.classList.add("is-invalid");let o=document.getElementById(e+"-error");o||(o=document.createElement("div"),o.id=e+"-error",o.className="invalid-feedback",n.parentNode.insertBefore(o,n.nextSibling)),o.textContent=t,o.style.display="block"}}function n(e){let t=document.getElementById(e);if(t){t.classList.remove("is-invalid");let n=document.getElementById(e+"-error");n&&(n.style.display="none")}}function o(){let e=document.getElementById("step1-general-error");e&&(e.style.display="none",e.textContent="")}e.translationObservable=globalThis.translations,e.building_id=ko.observable(),e.showErrorMessages=ko.observable(!1),e.formStep=ko.observable(0),e.bookingDate=ko.observable(""),e.bookingStartTime=ko.observable(""),e.bookingEndTime=ko.observable(""),e.goNext=()=>{0===a.formStep()?function(){let i=!0;return 0===e.selectedResources().length?(i=!1,t("select-multiple",trans("bookingfrontend","please_select_at_least_one_resource"))):n("select-multiple"),0===e.date().length?(i=!1,t("date-time-selection",trans("bookingfrontend","please_select_at_least_one_date_and_time"))):n("date-time-selection"),i&&o(),i}()?(o(),e.formStep(e.formStep()+1),window.scrollTo({top:0,behavior:"smooth"})):function(){let e=document.getElementById("step1-general-error");e||(e=document.createElement("div"),e.id="step1-general-error",e.className="alert alert-danger mt-3",document.querySelector(".new-application-page").insertBefore(e,document.querySelector(".new-application-page").firstChild)),e.textContent=trans("bookingfrontend","please_correct_errors_before_proceeding"),e.style.display="block",window.scrollTo({top:0,behavior:"smooth"})}():1===a.formStep()&&function(){let i=!0;e.audienceSelectedValue()?n("audienceDropdown"):(i=!1,t("audienceDropdown",trans("bookingfrontend","please_select_target_audience"))),document.getElementById("inputEventName").value.trim()?n("inputEventName"):(i=!1,t("inputEventName",trans("bookingfrontend","please_enter_event_name"))),document.getElementById("inputOrganizerName").value.trim()?n("inputOrganizerName"):(i=!1,t("inputOrganizerName",trans("bookingfrontend","please_enter_organizer")));let a=!1;e.agegroupList().forEach((function(e){(e.inputCountMale()||e.inputCountFemale())&&(a=!0)})),a?n("participants-container"):(i=!1,t("participants-container",trans("bookingfrontend","please_enter_participants")));const s=document.querySelectorAll('#regulation_documents input[name="accepted_documents[]"]');return console.log("found documents",s),s.length>0?document.querySelector('#regulation_documents input[name="accepted_documents[]"]:checked')?n("regulation_documents"):(i=!1,t("regulation_documents",trans("bookingfrontend","please_accept_terms"))):n("regulation_documents"),i?o():function(){let e=document.getElementById("step2-general-error");e||(e=document.createElement("div"),e.id="step2-general-error",e.className="alert alert-danger mt-3",document.querySelector(".new-application-page").insertBefore(e,document.querySelector(".new-application-page").firstChild)),e.textContent=trans("bookingfrontend","please_correct_errors_before_proceeding"),e.style.display="block",window.scrollTo({top:0,behavior:"smooth"})}(),i}()&&document.getElementById("application_form").submit()},e.goPrev=()=>{e.formStep(e.formStep()-1),window.scrollTo({top:0,behavior:"smooth"})},e.formatDate=function(e){const t=luxon.DateTime.fromFormat(e.from_,"dd/MM/yyyy HH:mm");return t.day+". "+["jan","feb","mar","apr","mai","jun","jul","aug","sep","okt","nov","des"][t.month-1]},e.formatTimePeriod=function(e){return e.from_.split(" ")[1]+"-"+e.to_.split(" ")[1]},e.bookableResource=ko.observableArray(),e.selectedResourcesOld=ko.observableArray(0),e.isResourceSelected=ko.computed((function(){for(var t=[],n=0,o=0;o<e.bookableResource().length;o++)e.bookableResource()[o].selected()?(t.push(e.bookableResource()[o].id),e.selectedResourcesOld.indexOf(e.bookableResource()[o].id)<0&&e.selectedResourcesOld.push(e.bookableResource()[o].id),n++):e.selectedResourcesOld.indexOf(e.bookableResource()[o].id)>-1&&e.selectedResourcesOld.splice(e.selectedResourcesOld.indexOf(e.bookableResource()[o].id),1);if(n>0){var i=t,a=l;return!(i.length!=a.length||!i.every((function(e,t){return e===a[t]})))||(l=t,$("#regulation_documents").empty(),function(e){for(var t={menuaction:"bookingfrontend.uidocument_view.regulations","owner[]":"building::"+s.building_id,sort:"name"},n=phpGWLink("bookingfrontend/",t,!0),o=0;o<e.length;o++)n+="&owner[]=resource::"+e[o];$.getJSON(n,(function(e){c(e.data)}))}(t),"function"!=typeof populateTableChkArticles||(populateTableChkArticles([],t,"","",""),!0))}return!1})).extend({required:!0}),e.audiences=ko.observableArray(),e.audienceSelectedValue=ko.observable(),e.activityId=ko.observable(),e.date=ko.observableArray(),e.addDate=function(){if(e.bookingDate()&&e.bookingStartTime()&&e.bookingEndTime()){let d=e.bookingDate(),c=d.split(".");1===c[0].length&&(c[0]="0"+c[0],d=c.join(".")),1===c[1].length&&(c[1]="0"+c[1],d=c.join("."));let p=luxon.DateTime.fromFormat(d,"dd.MM.yyyy");var i=e.bookingStartTime().split(":"),a=e.bookingEndTime().split(":"),s=p.set({hour:parseInt(i[0]),minute:parseInt(i[1])}),r=p.set({hour:parseInt(a[0]),minute:parseInt(a[1])}),l=luxon.DateTime.local();s<l||r<l?t("date-time-selection",trans("bookingfrontend","selected_time_must_be_in_future")):s>=r?t("date-time-selection",trans("bookingfrontend","start_time_must_be_before_end_time")):(n("date-time-selection"),o(),ko.utils.arrayFirst(e.date(),(function(e){return e.id===[s.toISO(),r.toISO()].join("")}))||(e.date.push({id:[s.toISO(),r.toISO()].join(""),from_:s.toFormat("dd/MM/yyyy HH:mm"),to_:r.toFormat("dd/MM/yyyy HH:mm"),formatedPeriode:s.toFormat("dd/MM/yyyy HH:mm")+" - "+r.toFormat("HH:mm")}),setTimeout((function(){e.bookingDate(""),e.bookingStartTime(""),e.bookingEndTime(""),$(".applicationSelectedDates").html(""),"function"==typeof post_handle_order_table&&post_handle_order_table()}),500)))}else t("date-time-selection",trans("bookingfrontend","please_fill_all_date_and_time_fields"))},e.removeDate=function(t){e.date.remove(t),"function"==typeof post_handle_order_table&&setTimeout((function(){post_handle_order_table()}),500)},e.removeRessource=function(){this.selected(!1)},e.aboutArrangement=ko.observable(""),e.agegroupList=ko.observableArray(),e.specialRequirements=ko.observable(""),e.attachment=ko.observable(),e.schedule=ko.observableArray(),e.loadBuildingData=async()=>{try{if(!e.building_id()||!e.date()||0===e.date().length)return;let t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uibooking.building_schedule_pe",building_id:e.building_id(),dates_csv:e.date().map((e=>e.from_.split(" ")[0].replaceAll("/","-")))},!0);const[n]=await Promise.all([fetch(t).then((async e=>(await e.json())?.ResultSet?.Result?.results))]);e.schedule(n?.schedule||[])}catch(e){console.error("Error loading building data:",e)}},e.building_id.subscribe((t=>{e.loadBuildingData()})),e.date.subscribe((t=>{e.loadBuildingData()})),e.selectedResources=ko.computed((()=>ko.utils.arrayFilter(e.bookableResource(),(function(e){return e.selected()})))),e.selectedResources.subscribe((function(e){e.length>0?(n("select-multiple"),o()):t("select-multiple",trans("bookingfrontend","please_select_at_least_one_resource"))})),e.selectedResourcesWithFacilities=ko.computed((function(){for(var t=ko.utils.arrayFilter(e.bookableResource(),(function(e){return e.selected()})),n=[],o=0;o<t.length;o++){var i=r()[t[o].id.toString()]||[];n.push({resourceName:t[o].name,facilities:i})}return n})),e.selectedResourcesOld.subscribe((function(t){e.bookableResource().forEach((function(e){var n=t.includes(e.id);$(`#select2-select-multiple-results [id*='${e.id}']`),$(this).attr("aria-selected","false"),$(this).attr("aria-fake-selected",n?"true":"false")}))})),$(document).ready((function(){var t=$("#select-multiple");$(".selected-items-display"),t.select2({theme:"select-v2",width:"100%",closeOnSelect:!1});const n=()=>{$(".select2-results__option[id^='select2-select-multiple-result-']").each((function(){var t=this.id.split("-");const n=t[t.length-1];console.log("updateSelected",n);var o=e.selectedResourcesOld().includes(+n);$(this).attr("aria-selected","false"),$(this).attr("aria-fake-selected",o?"true":"false")}))};function o(t){var o=t.params.data;console.log("Item selected/unselected: ",+o.id);var i=e.bookableResource().find((function(e){return e.id===+o.id}));console.log(e.bookableResource()),console.log(i),i&&i.selected(!i.selected()),console.log($(this)),$(this).val(null).trigger("change"),setTimeout((function(){n()}),0)}t.on("select2:open",(function(){setTimeout((function(){n()}),0)})),t.on("select2:select",o),t.on("select2:unselect",o)}))}function c(e){if(Array.isArray(e)&&0!==e.length){for(var t="",n=0;n<e.length;n++){var o="";null!=initialAcceptedDocs&&initialAcceptedDocs[n]==e[n].id&&(o=' checked="checked"'),t+='<div class="col-12 mb-4">',t+='<label class="choice">',t+='<input name="accepted_documents[]" value="'+e[n].id+'" type="checkbox"'+o+">",t+='<a class="d-inline termAcceptDocsUrl" target="_blank" href="'+RemoveCharacterFromURL(e[n].link,"amp;")+'">'+e[n].name+"</a>",t+='<span class="choice__check">',t+="</span>",t+="</label>",t+="</div>"}$("#regulation_documents").html(t)}else $("#regulation_documents").html("<p>"+trans("bookingfrontend","no_documents_to_accept")+"</p>")}$(document).ready((function(){var e;void 0===s.building_id&&(s.building_id=building_id),(a=new d).building_id(s.building_id);let t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.add",building_id:s.building_id,phpgw_return_as:"json"},!0);$.getJSON(t,(function(n){e=n.application.activity_id;for(var o=0;o<n.agegroups.length;o++)a.agegroupList.push({name:n.agegroups[o].name,agegroupLabel:n.agegroups[o].name,inputCountMale:ko.observable("").extend({number:!0}),inputCountFemale:ko.observable("").extend({number:!0}),malename:"male["+n.agegroups[o].id+"]",femalename:"female["+n.agegroups[o].id+"]",id:n.agegroups[o].id});if(null!=initialAgegroups)for(o=0;o<initialAgegroups.length;o++){var i=initialAgegroups[o].agegroup_id,l=ko.utils.arrayFirst(a.agegroupList(),(function(e){return e.id==i}));l&&(l.inputCountMale(initialAgegroups[o].male),l.inputCountFemale(initialAgegroups[o].female))}for(o=0;o<n.audience.length;o++)$.inArray(n.audience[o].id,initialAudience)>-1&&$("#audienceDropdownBtn").text(n.audience[o].name),a.audiences.push({id:n.audience[o].id,name:n.audience[o].name});t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiresource.index_json",filter_building_id:s.building_id,sort:"name",phpgw_return_as:"json"},!0),$.getJSON(t,(function(e){for(var t=0;t<e.results.length;t++){var n=e.results[t];if(1!==n.deactivate_application&&n.building_id==s.building_id){var o=!1;$.inArray(n.id,initialSelection)>-1&&(o=!0),void 0!==s.resource_id&&0==initialSelection.length&&s.resource_id==n.id&&(o=!0);var i=n.name,l=Math.floor(Date.now()/1e3);n.simple_booking&&n.simple_booking_start_date<l||1==n.hidden_in_frontend?i+=" *":(n.direct_booking&&n.direct_booking<l&&(i+=" *"),a.bookableResource.push({id:n.id,name:i,selected:ko.observable(o)}))}if(n.facilities_list&&Array.isArray(n.facilities_list)){var d=n.id.toString();r()[d]||(r()[d]=[]);for(var c=0;c<n.facilities_list.length;c++)r()[d].push(n.facilities_list[c])}}r.valueHasMutated()}));var d={menuaction:"bookingfrontend.uidocument_view.regulations","owner[]":"building::"+s.building_id,sort:"name"};for(t=phpGWLink("bookingfrontend/",d,!0),o=0;o<initialSelection.length;o++)t+="&owner[]=resource::"+initialSelection[o];$.getJSON(t,(function(e){c(e.data)}))})).done((function(){a.activityId(e),console.log("Applying bindings"),ko.applyBindings(a,document.getElementById("new-application-page")),function(){if(null!=initialDates)for(var e=0;e<initialDates.length;e++){var t=initialDates[e].from_.replace(" ","T"),n=initialDates[e].to_.replace(" ","T");a.date.push({from_:formatDateToDateTimeString(new Date(t)),to_:formatDateToDateTimeString(new Date(n)),formatedPeriode:formatDate(new Date(t),new Date(n))})}else void 0!==s.start&&void 0!==s.end&&s.start.length>0&&s.end.length>0&&a.date.push({from_:formatDateToDateTimeString(new Date(parseInt(s.start))),to_:formatDateToDateTimeString(new Date(parseInt(s.end))),formatedPeriode:formatDate(new Date(parseInt(s.start)),new Date(parseInt(s.end)))})}(),function(){if(void 0!==s.fromDate){let e=new Date(s.fromDate);a.bookingDate(e);let t=new Intl.DateTimeFormat("en",{year:"numeric"}).format(e),n=new Intl.DateTimeFormat("en",{month:"2-digit"}).format(e),o=new Intl.DateTimeFormat("en",{day:"2-digit"}).format(e);$(".datepicker-btn").val(`${o}/${n}/${t}`)}}(),"undefined"!=typeof initialAudience&&a.audienceSelectedValue(initialAudience)})),$(".resourceDropdown").on("click",(function(){$(this).parent().toggleClass("show")})),$("#application_form").submit((function(e){a.validateStep2()?function(){const e=$('#regulation_documents input[name="accepted_documents[]"]');if(0===e.length)return!0;var t=0;return e.each((function(){$(this).is(":checked")||t++})),0===t}()||(alert(errorAcceptedDocs),e.preventDefault()):(e.preventDefault(),e.stopPropagation())}))})),new Date;const p=document.getElementById("field_name_input"),u=document.getElementById("field_name"),m=document.getElementById("attachment-remove"),g=document.getElementById("attachment"),f=document.getElementById("attachment-upload");function b(e,t){const n=document.createElement("div");n.className="alert "+t,n.appendChild(document.createTextNode(e)),g.insertBefore(n,f),m.className="isDisabled",f.className="isDisabled",setTimeout((function(){document.querySelector(".alert").remove(),m.classList.remove("isDisabled"),f.classList.remove("isDisabled")}),2500)}u&&(u.addEventListener("change",(function(){""===u.value&&""===u.textContent||(m.style.display="block")})),document.getElementById("field_name").onchange=function(){var e=!1,t=this.value,n=this.accept;if(t){var o=t.split(/(\\|\/)/g).pop();$("#field_name_input").empty().append(o);var i="."+o.split(".").pop();const a=new RegExp(i);n.match(a)||(e=!0,b("Ugyldig filtype!","alert-danger"))}u.files[0].size>2e6&&(e=!0,b("Filen er for stor!","alert-danger")),e&&(p.textContent="",u.value="",m.style.display="none")},m.addEventListener("click",(function(){""===p.textContent&&""===u.value||(b("Vedlegg fjernet!","alert-success"),p.textContent="",u.value="",m.style.display="none")}))),window.onload=function(){const e=document.getElementById("submit-error"),t=document.getElementById("inputEventName"),n=document.getElementById("inputOrganizerName"),o=document.getElementById("inputTargetAudience");if(!t)return void console.error("inputEventName missing!");if(!e)return void console.error("submit-error missing!");if(!n)return void console.error("inputOrganizerName missing!");if(!o)return void console.error("inputTargetAudience missing!");let i=[t,n];for(let e=0;e<i.length;e++)i[e].addEventListener("input",(function(e){e.target.value?(e.target.classList.remove("is-invalid"),e.target.classList.add("is-valid")):(e.target.classList.add("is-invalid"),e.target.classList.remove("is-valid"))}));form.addEventListener("submit",(function(i){a.bookingDate()&&a.bookingStartTime()&&a.bookingEndTime()&&(a.date().some((function(e){return e.from_===a.bookingDate()&&e.to_===a.bookingStartTime()&&e.formatedPeriode===a.bookingEndTime()}))||a.addDate()),t.value&&n.value&&o.value||(i.preventDefault(),i.stopPropagation(),t.value?t.classList.replace("is-invalid","is-valid")||t.classList.add("is-valid"):t.classList.add("is-invalid"),n.value?n.classList.replace("is-invalid","is-valid")||n.classList.add("is-valid"):n.classList.add("is-invalid"),function(){const e=document.getElementById("audienceDropdown");e.value?e.classList.add("is-valid"):e.classList.add("is-invalid")}(),e.style.display="block",setTimeout((function(){e.style.display="none"}),5e3))}))}})()})();