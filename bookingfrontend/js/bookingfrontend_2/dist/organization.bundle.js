(()=>{var e={792:()=>{ko.bindingHandlers.slidedownTarget={init:function(e,t){var i=t();"function"==typeof i&&i(e)}},ko.components.register("resource-info-card",{viewModel:function(e){this.resource=e.resource,this.buildings=ko.isObservable(e.buildings)?e.buildings():e.buildings,this.towns=e.towns,this.date=e.date,this.lang=e.lang,this.disableText=e.disableText||!1,this.expanded=ko.observable(!1),this.static=e.static||!1,this.filterGroups=e.filterGroups||void 0,this.cleanTownName=function(e){return e.split("\n").map((e=>(e.toLowerCase().includes("bydel")&&(e=e.replace(/bydel/gi,"").trim()),e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()))).join("\n")},this.description_text=ko.computed((()=>{if(this.disableText)return"";const e=JSON.parse(this.resource.description_json);return(new DOMParser).parseFromString(this.lang&&e[this.lang]||e.no,"text/html").documentElement.textContent})),this.url=ko.computed((()=>this.buildings&&0!==this.buildings.length?1===this.resource.simple_booking?phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiresource.show",building_id:this.buildings?.[0].id,id:this.resource.id},!1):phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uiapplication.add",building_id:this.buildings?.[0].id,resource_id:this.resource.id},!1):"")),this.locationUrl=ko.computed((()=>this.buildings&&0!==this.buildings.length?phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uibuilding.show",id:this.buildings?.[0].id}):"")),this.calendarId=`calendar-${this.resource.id}`,this.infoText=ko.computed((()=>{const e=this.towns().map((e=>this.cleanTownName(e.name))).join(" • "),t=this.buildings?.map((e=>`<a href="${phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uibuilding.show",id:void 0!==e.original_id?e.original_id:e.id},!1,e.remoteInstance?.webservicehost||void 0)}" class="link-text link-text-primary"><i class="fa-solid fa-location-dot"></i>${e.name}</a>`)).join(" • ");return[this.resource.remoteInstance?.name?`<span class="text-overline">${this.resource.remoteInstance?.name}</span>`:"",`<span class="text-overline">${e}</span>`,t].filter(Boolean).join(" • ")})),this.toggle=(e,t)=>{if("A"===t.target?.tagName)return!0;const i=t.target.closest(".js-slidedown.slidedown").querySelector(".js-slidedown-content.slidedown__content"),n=!this.expanded();return n?$(i).slideDown():$(i).slideUp(),this.expanded(n),!1}},template:'\n        <div class="col-12 mb-4">\n    <div class="js-slidedown slidedown">\n        <button class="js-slidedown-toggler slidedown__toggler" type="button" aria-expanded="false" data-bind="click: toggle">\n            <span><div class="fa-solid fa-layer-group"></div> <span data-bind="text: resource.name"></span></span>\n            <span class="slidedown__toggler__info" data-bind="html: infoText"></span>\n        </button>\n\n            <div class="js-slidedown-content slidedown__content">\n                \x3c!-- ko ifnot: disableText --\x3e\n                    <div>\n                        <p data-bind="html: description_text"></p>\n                    </div>\n                \x3c!-- /ko --\x3e\n\n                \x3c!-- ko if: expanded --\x3e\n                \x3c!-- ko if: date --\x3e\n                    \x3c!-- ko component: {\n                        name: \'pe-calendar\',\n                        params: {\n                            building_id: buildings[0].original_id || buildings[0].id,\n                            resource_id: resource.original_id || resource.id,\n                            instance: resource.remoteInstance?.webservicehost || \'\',\n                            dateString: date,\n                            nointeraction: static,\n                            filterGroups: filterGroups\n                        }\n                    } --\x3e\n                    \x3c!-- /ko --\x3e\n                    \x3c!-- /ko --\x3e\n                \x3c!-- /ko --\x3e\n            </div>\n    </div>\n</div>\n\n    '})},120:()=>{ko.bindingHandlers.select2={init:function(e,t,i){var n={theme:"select-v2",width:"100%",...t()||{}};$(e).select2(n),ko.utils.domNodeDisposal.addDisposeCallback(e,(function(){$(e).select2("destroy")}))},update:function(e,t,i){ko.unwrap(t());var n=i().selectedOptions,s=i().value;n&&0===ko.unwrap(n).length&&$(e).val(ko.unwrap(n)).trigger("change"),s&&void 0===ko.unwrap(s)&&$(e).val(ko.unwrap(s)).trigger("change")}},ko.bindingHandlers.datepicker={init:function(e,t,i){var n={dateFormat:"d.m.yy",changeMonth:!0,changeYear:!0,dayNames:["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"],dayNamesMin:["Sø","Ma","Ti","On","To","Fr","Lø"],dayNamesShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],monthNames:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],monthNamesShort,firstDay:1};$(e).datepicker(n),ko.utils.domNodeDisposal.addDisposeCallback(e,(function(){$(e).datepicker("destroy")}))}},ko.bindingHandlers.multiselectWithDatepicker={init:function(e,t,i){var n={select2Options:{theme:"select-v2 select-v2--main-search",width:"100%"},datepickerOptions:{dateFormat:"d.m.yy",changeMonth:!0,changeYear:!0,dayNames:["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"],dayNamesMin:["Sø","Ma","Ti","On","To","Fr","Lø"],dayNamesShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],monthNames:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],monthNamesShort,firstDay:1}};$(e).find(".js-select-multisearch").select2(n.select2Options),$(e).find("#datepicker").datepicker(n.datepickerOptions),$(e).find(".multisearch__inner__item").on("mouseDown",(function(){$(this).find("span .select2-container--open")?($(this).find(".js-select-multisearch").select2("open"),$(this).find("#datepicker").datepicker("show")):($(this).find(".js-select-multisearch").select2("close"),$(this).find("#datepicker").datepicker("hide"))})),ko.utils.domNodeDisposal.addDisposeCallback(e,(function(){$(e).find(".js-select-multisearch").select2("destroy"),$(e).find("#datepicker").datepicker("destroy")}));var s=i().selectedOptions;ko.isObservable(s)?s.subscribe((function(){$(e).find(".js-select-multisearch").val(ko.unwrap(s)).trigger("change")})):console.log("OH NO")},update:function(e,t,i){var n=i().selectedOptions;n&&(console.log("CHANGEVENT",ko.unwrap(n)),$(e).find(".js-select-multisearch").val(ko.unwrap(n)).trigger("change"))}},ko.bindingHandlers.toggleFilter={init:function(e,t){$(e).click((function(){$(this).toggleClass("toggle-filter--show"),$(".filter-element").toggleClass("d-block"),$(this).hasClass("toggle-filter--show")?$(this).text("Se færre filter"):$(this).text("Se flere filter")}))}}},940:()=>{if(!globalThis.trans){globalThis.translations=ko.observable({}),globalThis.translationsLoaded=ko.observable(!1);const e=phpGWLink("bookingfrontend/lang.php",null,!0);fetch(e).then((e=>e.json())).then((e=>{globalThis.translations(e),globalThis.translationsLoaded(!0)})),globalThis.trans=(e,t,...i)=>{const n=globalThis.translations(),s=e=>n[e]&&n[e][t]?n[e][t].replace(/%\d+/g,(e=>{const t=parseInt(e.substring(1))-1;return void 0!==i[t]?i[t]:e})):null;if(Array.isArray(e))for(let t=0;t<e.length;t++){const i=s(e[t]);if(null!==i)return i}else{const t=s(e);if(null!==t)return t}if(!Array.isArray(e)||!e.includes("common")){const e=s("common");if(null!==e)return e}return`Missing translation for [${Array.isArray(e)?e.join(", "):e}][${t}]`};class t{constructor(e,t){let i=t.templateNodes.map((e=>e.textContent));1===i.length&&i[0].includes(":")&&(i=i[0].split(":")),i=i.map((e=>e.trim())),i.length>=2?(this.tag=ko.observable(i[1]),this.group=ko.observable(i[0])):(this.tag="function"==typeof e.tag?e.tag:ko.observable(e.tag),this.group="function"==typeof e.group?e.group:ko.observable(e.group)),this.suffix=ko.observable(e.suffix||""),this.args=ko.observable(e.args),this.translations=globalThis.translations,this.translated=ko.computed((()=>{if(self.translations&&self.translations()&&Object.keys(self.translations()).length>0&&this.group&&this.tag)return globalThis.trans(this.group(),this.tag(),this.args())+this.suffix()}))}}ko.components.register("trans",{viewModel:{createViewModel:function(e,i){return new t(e,i)}},template:"\x3c!--ko text: translated()--\x3e\x3c!--/ko--\x3e"})}},16:()=>{ko.bindingHandlers.withAfterRender={init:function(e,t,i,n,s){var o=ko.unwrap(t());ko.applyBindingsToNode(e,{visible:!0},s),o&&o.afterRender&&o.afterRender.call(n,e)}}}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,i),o.exports}(()=>{"use strict";function e(e,t,i,n){if(n){const e=n.split("/").filter((e=>""!==e&&!e.includes("http")));n="//"+e.slice(0,e.length-1).join("/")+"/"}const s=(n||strBaseURL).split("?");let o=s[0]+e+"?";null==t&&(t=new Object);for(const e in t)o+=e+"="+t[e]+"&";return s[1]&&(o+=s[1]),i&&(o+="&phpgw_return_as=json"),o}function t(e){return`${e.getDate()}.${e.getMonth()+1}.${e.getFullYear()}`}function n(e,t){let i=[t];return e.filter((e=>e.parent_id===t)).map((t=>{i.push(...n(e,t.id))})),i}function s(e){const t=(new DOMParser).parseFromString(e,"text/html").documentElement.textContent;return(new DOMParser).parseFromString(t,"text/html").documentElement.textContent}ko.components.register("map-modal",{viewModel:{createViewModel:function(e,t){return(e=>{let i=t.templateNodes.map((e=>e.textContent));1===i.length&&i[0].includes("\n")&&(i=i[0].split("\n")),i=i.map((e=>{return(t=e.trim()).endsWith(",")&&(t=t.slice(0,-1)),t;var t})),self.mapParts=ko.observableArray(i),self.randomHash=ko.observable(function(e=8){return Array.from({length:e},(()=>Math.floor(36*Math.random()).toString(36))).join("")}()),self.descriptionExpanded=ko.observable(!1),self.toggleDescription=()=>{self.descriptionExpanded(!self.descriptionExpanded())},self.shortPath=ko.computed((()=>self.mapParts().slice(0,2).join(", "))),self.longPath=ko.computed((()=>`https://maps.google.com/maps?f=q&source=s_q&hl=no&output=embed&geocode=&q=${self.mapParts().join(",")}`)),self.openModal=()=>{$("#mapModal"+randomHash()).modal("show")},self.closeModal=()=>{$("#mapModal"+randomHash()).modal("hide")}})()}},template:'\n        <button type="button" class="pe-btn pe-btn-text-primary pe-btn-text pe-btn--transparent  p-0"\n                data-bind="click: function() { openModal() }">\n            <div class="d-flex gap-1 align-items-center">\n                <i class="fa-solid fa-map-pin" style="font-size: 1rem"></i>\n                <span class="text-label" data-bind="text: shortPath"></span>\n            </div>\n        </button>\n\n        <div class="modal fade" data-bind="attr: {id: \'mapModal\' + randomHash()}" tabindex="-1"\n             aria-labelledby="mapModal"\n             aria-hidden="true">\n            <div class="modal-dialog modal-xl" style="height: 100%">\n                <div class="modal-content" style="height: 80%;">\n                    <div class="modal-header border-0">\n                        <button type="button" class="btn-close text-grey-light" data-bs-dismiss="modal"\n                                aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body d-flex justify-content-center pt-0 pb-4">\n                        <div style="display: flex; justify-content: center; align-items: stretch; width: 100%;">\n                            <iframe id="iframeMap" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"\n                                    style="width: 100%;" data-bind="attr:{src: longPath()}">\n                            </iframe>\n                        </div>\n                        <br/>\n\n                    </div>\n                </div>\n            </div>\n        </div>\n    '}),i(16),ko.components.register("collapsable-text",{viewModel:function(e){const t=this;t.content=e.content,t.descriptionExpanded=ko.observable(!1),t.contentSize=ko.observable(0),t.containerSize=ko.observable(0),t.contentElement=ko.observable(null),t.toggleDescription=()=>{t.descriptionExpanded(!t.descriptionExpanded())},t.afterRenderContent=e=>{console.log("after element set",e),t.contentElement(e)},t.isActive=ko.computed((()=>{const e=t.contentElement();return!e||(console.log("setting active",e.parentElement.scrollHeight,e.parentElement.clientHeight),e.parentElement.scrollHeight>e.parentElement.clientHeight||e.parentElement.scrollWidth>e.parentElement.clientWidth)}))},template:'\n        <div class="col-sm-12 d-flex flex-column collapsible-content collapsed-description"\n             data-bind="css: {\'collapsed-description-fade\': !descriptionExpanded() && isActive, \'collapsed-description\': !descriptionExpanded()}">\n            \x3c!-- ko if: content --\x3e\n            <p data-bind="html: content,withAfterRender: { afterRender: afterRenderContent}"></p>\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko ifnot: content --\x3e\n            <p data-bind="template: { nodes: $componentTemplateNodes }, withAfterRender: { afterRender: afterRenderContent}"></p>\n            \x3c!-- /ko --\x3e\n        </div>\n        <div class="col-sm-12 " data-bind="visible: isActive">\n            <button class="pe-btn  pe-btn--transparent text-secondary d-flex gap-3"\n                    data-bind="click: () => toggleDescription()">\n                \x3c!-- ko if: descriptionExpanded() --\x3e\n                <span><trans params="group: \'bookingfrontend\',tag: \'show_less\'"></span>\n                \x3c!-- /ko --\x3e\n                \x3c!-- ko ifnot: descriptionExpanded() --\x3e\n                <span><trans params="group: \'bookingfrontend\',tag: \'show_more\'"></span>\n                \x3c!-- /ko --\x3e\n                <i class="fa"\n                   data-bind="css: {\'fa-chevron-up\': descriptionExpanded(), \'fa-chevron-down\': !descriptionExpanded()}"></i>\n            </button>\n        </div>\n    '}),i(940),$(document).ready((function(){$("input[type=radio][name=select_template]").change((function(){var t=$(this).val(),i=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{template_set:t},url:i,success:function(e){location.reload(!0)}})})),$("input[type=radio][name=select_language]").change((function(){var t=$(this).val(),i=e("bookingfrontend/",{menuaction:"bookingfrontend.preferences.set"},!0);$.ajax({type:"POST",dataType:"json",data:{lang:t},url:i,success:function(e){location.reload(!0)}})}))})),i(792),i(120);class o{building_resources;towns_data;activities;resources;facilities;resource_categories;resource_activities;resource_category_activity;subscriptions=[];towns=ko.observableArray([]);selected_town=ko.observable();selected_buildings=ko.observableArray([]);selected_activities=ko.observableArray([]);selected_resource_categories=ko.observableArray([]);selected_resources=ko.observableArray([]);selected_facilities=ko.observableArray([]);text=ko.observable("");date=ko.observable(t(new Date));show_only_available=ko.observable(!1);result_all=ko.observableArray([]);available_resources=ko.observableArray([]);taken_allocations=ko.observableArray([]);seasons=ko.observableArray([]);resources_with_available_time=ko.observableArray([]);easy_booking_available_ids=ko.observableArray([]);show_more_filters=ko.observable(!1);result=ko.observableArray([]);result_shown=ko.observable(25);activity_cache={};allocation_cache={};easy_booking_available_cache={};easy_booking_not_available_cache={};lang="no";translationObservable=globalThis.translations;strings={search:ko.computed((function(){return globalThis.translations&&globalThis.translations(),trans("common","search")})),transCallable:ko.computed((function(){return globalThis.translations&&globalThis.translations(),trans}))};constructor(e){e.instance(this),this.building_resources=e.building_resources,this.towns_data=e.towns_data,this.activities=e.activities,this.resources=e.resources,this.facilities=e.facilities,this.resource_categories=e.resource_categories,this.resource_facilities=e.resource_facilities,this.resource_activities=e.resource_activities,this.resource_category_activity=e.resource_category_activity,this.lang=getCookie("selected_lang")||"no",this.show_only_available.subscribe((e=>{e||this.resources_with_available_time([]),this.searchFetch()})),this.towns_data.subscribe((e=>{this.towns([...new Set(e.map((e=>e.name)))].sort(((e,t)=>e.localeCompare(t,"no"))).map((t=>({name:s(t),id:e.find((e=>e.name===t)).id}))))})),this.activities.subscribe((e=>{for(const t of e)this.activity_cache[t.id]=n(e,t.id)})),this.result_all.subscribeChanged(((e,t)=>{(function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0})(e.map((e=>e.id)).sort(),t.map((e=>e.id)).sort())||this.show_only_available()&&this.fetchAvailableResources()})),window.addEventListener("scroll",this.handleScroll.bind(this)),this.initializeComputed(),this.initializeSubscriptions()}initializeSubscriptions(){this.subscriptions=[this.text.subscribe((e=>this.searchFetch())),this.selected_buildings.subscribe((e=>this.searchFetch())),this.selected_resource_categories.subscribe((e=>this.searchFetch())),this.selected_facilities.subscribe((e=>this.searchFetch())),this.selected_activities.subscribe((e=>{this.searchFetch()})),this.date.subscribe((e=>{""!==e?this.searchFetch():this.date(t(new Date))})),this.selected_town.subscribe((e=>{this.searchFetch()}))]}initializeComputed(){this.buildings=ko.computed((()=>{if(!this.towns_data||!this.towns_data())return[];const e=this.selected_town();return this.towns_data().filter((t=>!e||e.id===t.id)).map((e=>({id:e.b_id,name:s(e.b_name),original_id:e.original_b_id,remoteInstance:e.remoteInstance}))).sort(((e,t)=>e.name?.localeCompare(t.name,"no")))}))}handleScroll(){window.scrollY+window.innerHeight>=document.documentElement.scrollHeight&&this.result_shown()<this.result().length&&this.result_shown(this.result_shown()+25)}fetchEasyBooking(t){const i=`${this.date()}`,n=`${this.date()}`;i in this.easy_booking_available_cache||(this.easy_booking_available_cache[i]=[],this.easy_booking_not_available_cache[i]=[]);const s=[...new Set(this.result_all().filter((e=>!this.easy_booking_not_available_cache[i].includes(e.id)&&!this.easy_booking_available_cache[i].includes(e.id))).map((e=>e.id)))];if(0===s.length)return void t();const o=e("bookingfrontend/",{menuaction:"bookingfrontend.uibooking.get_freetime_limit",start_date:i,end_date:n,resource_ids:s.join(","),length:-1},!0);$.ajax({url:o,success:e=>{this.populate_easy_booking_available_cache(e,i,s),t()},error:e=>{console.log(e),t()}})}fetchAvailableResources(){let t=!1,i=!1;const n=`${this.date()} 00:00:00`,s=`${this.date()} 23:59:59`,o=()=>{t&&i&&(this.available_resources([]),this.taken_allocations(this.result_all().filter((e=>1!==e.simple_booking)).map((e=>this.allocation_cache[n].allocations[e.id])).flat()),this.seasons(this.result_all().filter((e=>1!==e.simple_booking)).map((e=>this.allocation_cache[n].seasons[e.id])).flat()),this.calculateAvailableResources())};this.fetchEasyBooking((()=>{t=!0,o()})),n in this.allocation_cache||(this.allocation_cache[n]={},this.allocation_cache[n].allocations={},this.allocation_cache[n].seasons={});const a=[...new Set(this.result_all().filter((e=>1!==e.simple_booking)).filter((e=>!(e.id in this.allocation_cache[n].allocations))).map((e=>e.id)))];if(0===a.length)return i=!0,void o();const r=e("bookingfrontend/",{menuaction:"bookingfrontend.uisearch.search_available_resources",from_date:n,to_date:s,resource_ids:a.join(","),length:-1},!0);$.ajax({url:r,success:e=>{this.populate_allocation_cache(e,n,a),i=!0,o()},error:e=>{console.log(e)}})}populate_allocation_cache=(e,t,i)=>{const n=this.allocation_cache[t];i.map((e=>{e in n.allocations||(n.allocations[e]=[]),e in n.seasons||(n.seasons[e]=[])})),e.allocations.map((e=>{n.allocations[e.resource_id].push(e)})),e.seasons.map((e=>{n.seasons[e.resource_id].push(e)}))};populate_easy_booking_available_cache=(e,t,i)=>{const n=this.easy_booking_available_cache[t];Object.keys(e).map((t=>{e[t].map((e=>{e.overlap||n.push(e.applicationLink.resource_id)}))})),this.easy_booking_available_cache[t]=[...new Set(n)],this.easy_booking_not_available_cache[t]=[...new Set(i.filter((e=>!this.easy_booking_available_cache[t].includes(e))))]};reset(){for(const e of this.subscriptions)e.dispose();this.selected_town(null),this.selected_activities([]),this.selected_buildings([]),this.selected_resource_categories([]),this.selected_facilities([]),this.text(""),this.date(t(new Date)),this.initializeSubscriptions(),this.searchFetch()}searchFetch(){console.log("SEARCHING"),this.result_shown(25),this.show_only_available()?this.fetchAvailableResources():this.search()}search(){let e=[],t=!1;if((void 0!==this.selected_town()||this.selected_buildings().length>0||this.selected_facilities().length>0||this.selected_activities().length>0||this.selected_resource_categories().length>0)&&(e=this.resources(),void 0!==this.selected_town()&&(e=e.filter((e=>this.building_resources().some((t=>this.buildings().some((i=>i.id===t.building_id&&e.id===t.resource_id))))))),this.selected_buildings().length>0&&(e=e.filter((e=>this.building_resources().some((t=>this.selected_buildings().some((i=>i.id===t.building_id&&e.id===t.resource_id))))))),this.selected_facilities().length>0&&(e=e.filter((e=>this.selected_facilities().map((e=>e.id)).every((t=>this.resource_facilities().some((i=>i.resource_id===e.id&&i.facility_id===t))))))),this.selected_activities().length>0&&(e=e.filter((e=>this.selected_activities().map((e=>e.id)).every((t=>this.resource_activities().some((i=>this.activity_cache[t].includes(i.activity_id)&&e.id===i.resource_id))))))),this.selected_resource_categories().length>0&&(e=e.filter((e=>this.selected_resource_categories().some((t=>t.id===e.rescategory_id))))),t=!0),""!==this.text()){t||(e=this.resources());const i=new RegExp(this.text(),"i");let n=[],s=[];if(0===this.selected_buildings().length){const e=this.buildings().filter((e=>e.name.match(i)));n=this.getResourcesFromBuildings(e)}if(0===this.selected_activities().length){const e=this.activities().filter((e=>e.name.match(i))).map((e=>this.activity_cache[e.id])),t=this.resource_activities(),n=new Set(e.flatMap((e=>e.flatMap((e=>t.filter((t=>t.activity_id===e)))))).map((e=>e.resource_id)));s=this.resources().filter((e=>n.has(e.id)))}e=[...e.filter((e=>e.name.match(i)||n.some((t=>t.id===e.id)))),...s],t=!0}t?(e=e.reduce(((e,t)=>(-1===e.findIndex((e=>e.id===t.id))&&e.push(t),e)),[]),e=e.filter((e=>{const t=this.getBuildingsFromResource(e.id),i=this.getTownFromBuilding(t);return t.length>0&&i.length>0})),this.result_all(e),this.show_only_available()&&(e=e.filter((e=>this.resources_with_available_time().includes(e.id)))),console.log(e.length,"res"),this.result(e)):(function(e,t=0){const i=$("#search-count");i.empty(),e&&i.append(`Antall treff: ${e.length}${t>0?" av "+t:""}`)}(null),this.result([]))}showMoreResults(){this.result_shown(this.result_shown()+25)}calculateAvailableResources=()=>{const e=e=>{const[t,i,n]=e.split(":");return+n+60*+i+3600*+t},t=(e,t)=>{const i=new Date(e.split(" ")[0]),n=new Date(t.split(" ")[0]);return i.getDate()===n.getDate()&&i.getMonth()===n.getMonth()&&i.getFullYear()===n.getFullYear()},i=(e=>{const[t,i,n]=this.date().split(".");return new Date(`${n}-${i}-${t}`)})(this.date()).getDay(),n=this.taken_allocations().reduce(((i,n)=>(i[n.resource_id]=i[n.resource_id]||[],i[n.resource_id].push([e(n.from_.split(" ")[1]),t(n.from_,n.to_)?e(n.to_.split(" ")[1]):86400]),i)),{}),s=this.seasons().reduce(((t,n)=>(n.wday===i&&(n.resource_id in t||(t[n.resource_id]=[]),t[n.resource_id].push([e(n.from_time),e(n.to_time)])),t)),{}),o=Object.keys(s).filter((e=>!(e in n)||!((e,t)=>{e.sort(((e,t)=>e[0]-t[0]));const i=[e[0]];for(let t=1;t<e.length;t++){const n=i[i.length-1];e[t][0]<=n[1]?n[1]=Math.max(n[1],e[t][1]):i.push(e[t])}return i.reduce(((e,t)=>e+(t[1]-t[0])),0)>=t.reduce(((e,t)=>e+(t[1]-t[0])),0)})(n[e],s[e]))).map((e=>+e));this.resources_with_available_time([...new Set([...o,...this.easy_booking_available_cache[this.date()]])])};getResourcesFromBuildings=e=>{const t=e.map((e=>e.id));return this.building_resources().filter((e=>t.includes(e.building_id))).map((e=>this.resources().find((t=>t.id===e.resource_id)))).filter((e=>!!e))};getBuildingsFromResource=e=>{const t=this.building_resources().filter((t=>t.resource_id===e)).map((e=>e.building_id));return this.buildings().filter((e=>t.includes(e.id)))};getTownFromBuilding=e=>{const t=e.map((e=>e.id));return this.towns_data().filter((e=>t.includes(e.b_id)))};cleanTownName=e=>e.split("\n").map((e=>(e.toLowerCase().includes("bydel")&&(e=e.replace(/bydel/gi,"").trim()),e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()))).join("\n");resLength=ko.computed((()=>{const e=this.result().length;return this.result_shown()>e||this.result_shown(),`Antall treff: ${e}`}));adjustMobilePositionOnSearch(){let e=document.getElementById("search-booking");setTimeout((function(){window.scrollTo(0,e.getBoundingClientRect().top)}),200)}onTextFocus(e,t){if(!isMobile())return!0;let i=t.target;for(;i&&"bodySection"!==i.className;)i=i.parentElement;i&&i.scrollIntoView({behavior:"smooth",block:"start"})}}ko.components.register("booking-search",{viewModel:{createViewModel:(e,t)=>new o(e,t)},template:'\n        <div id="search-booking">\n            <div class="bodySection">\n                <div class="multisearch w-100">\n                    <div class="multisearch__inner multisearch__inner--no-button w-100">\n                        <div class="row flex-column flex-md-row mb-lg-4">\n                            <div class="col col-md-6 col-lg-6 mb-3 mb-lg-0">\n                                <div class="multisearch__inner__item">\n                                    <label for="search-booking-text">\n                                        <trans>common:search</trans>\n                                    </label>\n                                    <input id="search-booking-text" type="text"\n                                           data-bind="textInput: text, attr: {placeholder: strings.search}, event: { focus: onTextFocus }"/>\n\n                                </div>\n                            </div>\n\n                            <div class="col col-md-6 col-lg-3 mb-3 mb-lg-0 multisearch__inner--border">\n                                <div class="multisearch__inner__item">\n                                    <label for="search-booking-datepicker">\n                                        <trans>common:date</trans>\n                                    </label>\n                                    <input type="text" id="search-booking-datepicker" placeholder="dd.mm.yyyy"\n                                           class="js-basic-datepicker" data-bind="textInput: date, datepicker"/>\n                                </div>\n                            </div>\n                            <div class="col col-md-6 col-lg-3 mb-3 mb-lg-0 multisearch__inner--border"\n                                 data-bind="css: {\'filter-element\': !show_more_filters()}">\n                                <div class="multisearch__inner__item ">\n                                    <label class="text-bold text-primary" for="search-booking-activities">\n                                        <trans>bookingfrontend:activity</trans>\n                                    </label>\n                                    <select class="js-select-multisearch" id="search-booking-activities"\n                                            multiple="true" data-bind="options: activities,\n            optionsText: \'name\',\n            selectedOptions: selected_activities,\n            attr: {\'aria-label\': strings.transCallable()(\'booking\',\'activities\')},\nselect2: {theme: \'select-v2 select-v2--main-search\'}\n            ">\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="row flex-column flex-md-row">\n                            <div class="col col-md-6 col-lg-3 mb-3 mb-lg-0"\n                                 data-bind="css: {\'filter-element\': !show_more_filters()}">\n                                <div class="multisearch__inner__item">\n                                    <label for="search-booking-area">\n                                        <trans>bookingfrontend:where</trans>\n                                    </label>\n                                    <select class="js-select-multisearch" id="search-booking-area"\n                                            data-bind="\n                                          options: towns,\n                                          optionsText: \'name\',\n                                          value: selected_town,\n                                          optionsCaption: strings.transCallable()(\'bookingfrontend\',\'district\'),\n                                          attr: {\'aria-label\': strings.transCallable()(\'bookingfrontend\',\'district\')},\n                                          select2: {theme: \'select-v2 select-v2--main-search\'}\n                                    ">\n                                    </select>\n                                </div>\n                            </div>\n                            <div class="col col-md-6 col-lg-3 mb-3 mb-lg-0 multisearch__inner--border"\n                                 data-bind="css: {\'filter-element\': !show_more_filters()}">\n                                <div class="multisearch__inner__item">\n                                    <label for="search-booking-building">\n                                        <trans>booking:what</trans>\n                                    </label>\n                                    <select class="js-select-multisearch" id="search-booking-building"\n                                            multiple="true"\n                                            data-bind="options: buildings,\n                            optionsText: \'name\',\n                            selectedOptions: selected_buildings,\n                            attr: {\'aria-label\': strings.transCallable()(\'bookingfrontend\',\'location\')},\nselect2: {theme: \'select-v2 select-v2--main-search\'}\n                            ">\n                                    </select>\n                                </div>\n                            </div>\n\n                            <div class="col col-md-6 col-lg-3 mb-3 mb-lg-0 multisearch__inner--border"\n                                 data-bind="css: {\'filter-element\': !show_more_filters()}">\n                                <div class="multisearch__inner__item">\n                                    <label class="text-bold text-primary" for="search-booking-resource_categories">\n                                        <trans>booking:type</trans>\n                                    </label>\n                                    <select class="js-select-multisearch" id="search-booking-resource_categories"\n                                            multiple="true" data-bind="options: resource_categories,\n            optionsText: \'name\',\n            selectedOptions: selected_resource_categories,\n            attr: {\'aria-label\': strings.transCallable()(\'booking\',\'resource_category\')},\nselect2: {theme: \'select-v2 select-v2--main-search\'}\n            ">\n                                    </select>\n                                </div>\n                            </div>\n                            <div class="col col-md-6 col-lg-3 mb-3 mb-lg-0 multisearch__inner--border"\n                                 data-bind="css: {\'filter-element\': !show_more_filters()}">\n                                <div class="multisearch__inner__item">\n                                    <label class="text-bold text-primary" for="search-booking-facilities">\n                                        <trans>bookingfrontend:facilities</trans>\n                                    </label>\n                                    <select class="js-select-multisearch" id="search-booking-facilities"\n                                            multiple="true" data-bind="options: facilities,\n            optionsText: \'name\',\n            selectedOptions: selected_facilities,\n            attr: {\'aria-label\': strings.transCallable()(\'bookingfrontend\',\'facilities\')},\nselect2: {theme: \'select-v2 select-v2--main-search\'}\n\n            ">\n                                    </select>\n                                </div>\n                            </div>\n                            <div class="d-flex d-md-none justify-content-end">\n                                <button id="js-toggle-filter"\n                                        class="pe-btn pe-btn-secondary align-self-end gap-2 d-flex"\n                                        data-bind="click: () => show_more_filters(!show_more_filters())">\n                                    \x3c!-- ko if: !show_more_filters() --\x3e\n                                    <trans>bookingfrontend:see_more_filters</trans>\n                                    \x3c!-- /ko --\x3e\n                                    \x3c!-- ko if: show_more_filters() --\x3e\n                                    <trans>bookingfrontend:see_less_filters</trans>\n                                    \x3c!-- /ko --\x3e\n                                    <i class="fa"\n                                       data-bind="css: {\'fa-chevron-up\': show_more_filters(), \'fa-chevron-down\': !show_more_filters()}"></i>\n                                    \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div id="search-count" class="pt-3" data-bind="text: resLength"></div>\n\n            <div class="col-12 d-flex justify-content-start my-4 mb-md-0">\n                <input type="checkbox" id="show_only_available" class="checkbox-fa"\n                       data-bind="checked: show_only_available"/>\n                <label class="choice text-purple text-label" for="show_only_available">\n                    <i class="far fa-square unchecked-icon"></i>\n                    <i class="far fa-check-square checked-icon"></i>\n                    <trans>bookingfrontend:show_only_available</trans>\n                </label>\n            </div>\n\n            <div id="search-result" class="pt-3">\n                <div data-bind="foreach: { data: result.slice(0, result_shown()), as: \'resource\' }">\n                    <resource-info-card\n                            params="{ resource: resource, buildings: $parent.getBuildingsFromResource(resource.id), towns: $parent.getTownFromBuilding($parent.getBuildingsFromResource(resource.id)), lang: $parent.lang, towns_data: $parent.towns_data, date: $parent.date }"></resource-info-card>\n                </div>\n                \x3c!--                <button data-bind="visible: result_shown() < result().length, click: showMoreResults"--\x3e\n                \x3c!--                        class="btn btn-primary mt-3">Show More--\x3e\n                \x3c!--                </button>--\x3e\n            </div>\n        </div>\n    '}),ko.bindingHandlers.groupsDisplay={update:function(e,t,i,n,s){var o=ko.unwrap(t()),a=organization_write_permission,r=o.map((function(e){return a?`<a href="${phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uigroup.show",id:e.id})}"\n                           class="pe-btn  pe-btn--transparent pe-btn-text-primary pe-btn-text-overline p-0">${e.name}</a>`:e.name}));a&&r.push(`\n                <a href="${phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uigroup.edit",organization_id})}" class="pe-btn  pe-btn--transparent pe-btn-text-secondary pe-btn-text-overline  p-0">\n                    + ${trans("booking","new group")}\n                </a>\n            `),e.innerHTML=`<span class="">${trans("booking","groups (2018)")}:\n                        </span>`+r.map((e=>e&&e.length>0?`<span class="d-flex align-items-center">${e}</span>`:null)).filter((e=>e)).join('<span class="slidedown__toggler__info__separator"><i class="fa-solid fa-circle"></i></span>')}};const a=new class{organization_id=organization_id;buildings=ko.observableArray([]);groups=ko.observableArray();delegates=ko.observableArray();resources=ko.observableArray();towns=ko.observableArray();bookableResource=ko.observableArray();resourcesExpanded=ko.observable(!1);buildingsExpanded=ko.observable(!1);bookedByGroup=ko.observableArray();selectedResourceIds=ko.observableArray([]);selectedGroupIds=ko.observableArray([]);isBuildingCollapseActive=ko.observable(!0);isBuildingRendered=ko.observable(!1);isLoaded=globalThis.translationsLoaded;searchDate=ko.observable(luxon.DateTime.now().toFormat("dd.MM.yyyy"));constructor(){this.fetchBuildings(),this.fetchGroups(),organization_login&&this.fetchDelegates(),this.fetchCalendarEvents(),this.searchDate.subscribe((()=>this.fetchCalendarEvents()))}groupIds=ko.computed((()=>this.groups().map((e=>e.id))));toggleBuildingsExpanded(){this.buildingsExpanded(!this.buildingsExpanded())}buildingUrl(e){return phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uibuilding.show",id:e.id})}getTownFromBuilding=e=>{const t=e.map((e=>e.id));return this.towns().filter((e=>t.includes(e.b_id)))};getBuildingsFromResource=e=>this.resources().filter((t=>t.id===e)).map((e=>({id:e.building_id,name:e.building_name})));delegateUrl(e){return phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uidelegate.show",id:e.id})}fetchDelegates(){const e=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uidelegate.index",sort:"name",filter_organization_id:organization_id,length:-1},!0);fetch(e).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{"data"in e&&this.delegates(e.data)})).catch((e=>{console.error("Error fetching delegates:",e)}))}fetchGroups(){const e=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uigroup.index",sort:"name",filter_organization_id:organization_id,length:-1},!0);fetch(e).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{"data"in e&&this.groups(e.data)})).catch((e=>{console.error("Error fetching groups:",e)}))}fetchBuildings(){const e=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uibuilding.find_buildings_used_by",sort:"name",organization_id,length:-1},!0);fetch(e).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{"ResultSet"in e&&"Result"in e.ResultSet&&this.buildings(e.ResultSet.Result)})).catch((e=>{console.error("Error fetching buildings:",e)}))}async fetchCalendarEvents(){const e=luxon.DateTime.fromFormat(this.searchDate(),"dd.MM.yyyy"),t=phpGWLink("bookingfrontend/",{menuaction:"bookingfrontend.uibooking.organization_schedule",length:-1,date:`${e.year}-${e.month}-${e.day}`,organization_id},!0);try{const e=await fetch(t,{method:"GET",headers:{"Content-Type":"text/plain"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const i=await e.json();i.resources,this.resources(i.resources),this.towns(i.towns)}catch(e){console.error(e)}}resourcesContainerAfterRender(e){const t=e[0];this.isBuildingCollapseActive(t.parentElement.scrollHeight>t.parentElement.clientHeight||t.parentElement.scrollWidth>t.parentElement.clientWidth),this.isBuildingRendered(!0)}};ko.applyBindings(a,document.getElementById("organization-page-content"))})()})();