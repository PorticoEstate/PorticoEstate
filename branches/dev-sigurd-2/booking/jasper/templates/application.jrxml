<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report1" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<subDataset name="resources">
		<parameter name="APPLICATION_ID" class="java.lang.Integer"/>
		<queryString>
			<![CDATA[SELECT bb_resource.name AS resource_name, bb_resource.type AS resource_type FROM bb_application,bb_application_resource,bb_resource WHERE bb_application.id = $P{APPLICATION_ID} AND bb_application.id = bb_application_resource.application_id AND bb_application_resource.resource_id = bb_resource.id]]>
		</queryString>
		<field name="resource_name" class="java.lang.String"/>
		<field name="resource_type" class="java.lang.String"/>
	</subDataset>
	<subDataset name="targetaudience">
		<parameter name="APPLICATION_ID" class="java.lang.Integer"/>
		<queryString>
			<![CDATA[SELECT bb_targetaudience.name AS targetaudience FROM bb_application_targetaudience,bb_targetaudience WHERE bb_application_targetaudience.application_id = $P{APPLICATION_ID} AND bb_application_targetaudience.targetaudience_id = bb_targetaudience.id]]>
		</queryString>
		<field name="targetaudience" class="java.lang.String"/>
	</subDataset>
	<subDataset name="agegroup">
		<parameter name="APPLICATION_ID" class="java.lang.Integer"/>
		<queryString>
			<![CDATA[SELECT bb_agegroup.name AS agegroup , bb_application_agegroup.male, bb_application_agegroup.female FROM bb_agegroup,bb_application_agegroup WHERE bb_application_agegroup.application_id = $P{APPLICATION_ID} AND bb_application_agegroup.agegroup_id = bb_agegroup.id AND bb_agegroup.active = 1 ORDER BY bb_agegroup.sort]]>
		</queryString>
		<field name="agegroup" class="java.lang.String"/>
		<field name="male" class="java.lang.Integer"/>
		<field name="female" class="java.lang.Integer"/>
	</subDataset>
	<subDataset name="comment">
		<parameter name="APPLICATION_ID" class="java.lang.Integer"/>
		<queryString language="SQL">
			<![CDATA[SELECT
     to_char(time,'DD/MM/YYYY HH24:MI') AS date, author, comment FROM "bb_application_comment" bb_application_comment WHERE bb_application_comment.application_id = $P{APPLICATION_ID} AND bb_application_comment.type = 'comment']]>
		</queryString>
		<field name="date" class="java.lang.String"/>
		<field name="author" class="java.lang.String"/>
		<field name="comment" class="java.lang.String"/>
	</subDataset>
	<parameter name="BK_APPLICATION_ID" class="java.lang.String"/>
	<parameter name="BK_BUILDING_NAME" class="java.lang.String"/>
	<queryString language="SQL">
		<![CDATA[SELECT bb_application.id AS application_id, bb_application.status AS application_status, to_char(bb_application.created, 'DD/MM/YYYY HH24:MI') AS application_created, to_char(bb_application.modified, 'DD/MM/YYYY HH24:MI') AS application_modified,bb_application.contact_name, bb_application.contact_email,	bb_application.contact_phone,bb_application.description, to_char(bb_application_date.from_, 'DD/MM/YYYY HH24:MI') AS from, to_char(bb_application_date.to_, 'DD/MM/YYYY HH24:MI') AS to, bb_activity.name AS activity_name FROM bb_application, bb_application_date,bb_activity WHERE bb_application.id = $P!{BK_APPLICATION_ID} AND bb_application.id = bb_application_date.application_id AND bb_application.activity_id = bb_activity.id]]>
	</queryString>
	<field name="application_id" class="java.lang.Integer"/>
	<field name="application_status" class="java.lang.String"/>
	<field name="application_created" class="java.lang.String"/>
	<field name="application_modified" class="java.lang.String"/>
	<field name="contact_name" class="java.lang.String"/>
	<field name="contact_email" class="java.lang.String"/>
	<field name="contact_phone" class="java.lang.String"/>
	<field name="description" class="java.lang.String"/>
	<field name="from" class="java.lang.String"/>
	<field name="to" class="java.lang.String"/>
	<field name="activity_name" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="5" splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="79" splitType="Stretch">
			<staticText>
				<reportElement x="118" y="25" width="246" height="31"/>
				<textElement>
					<font size="24" isBold="true"/>
				</textElement>
				<text><![CDATA[ Aktivby søknad #]]></text>
			</staticText>
			<textField>
				<reportElement x="363" y="25" width="100" height="31"/>
				<textElement>
					<font size="24" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{BK_APPLICATION_ID}]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="2" y="0" width="102" height="74"/>
				<imageExpression class="java.lang.String"><![CDATA["/srv/portico/webapp/booking/jasper/templates/logo.png"]]></imageExpression>
			</image>
		</band>
	</pageHeader>
	<detail>
		<band height="471" splitType="Stretch">
			<elementGroup>
				<textField>
					<reportElement x="413" y="12" width="100" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{application_modified}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="51" y="13" width="100" height="19"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[( $F{application_status} == "CONFIRMED" ? "BEKREFTET" : $F{application_status} )]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="241" y="12" width="98" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{application_created}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="363" y="12" width="50" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Endret:]]></text>
				</staticText>
				<staticText>
					<reportElement x="0" y="13" width="51" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Status:]]></text>
				</staticText>
				<staticText>
					<reportElement x="171" y="12" width="70" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Opprettet:]]></text>
				</staticText>
			</elementGroup>
			<elementGroup>
				<textField>
					<reportElement x="51" y="63" width="100" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{activity_name}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="0" y="43" width="57" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Hvorfor:]]></text>
				</staticText>
				<staticText>
					<reportElement x="0" y="63" width="51" height="20"/>
					<textElement/>
					<text><![CDATA[Aktivtet:]]></text>
				</staticText>
				<staticText>
					<reportElement x="2" y="83" width="65" height="20"/>
					<textElement/>
					<text><![CDATA[Beskrivelse:]]></text>
				</staticText>
				<textField>
					<reportElement x="0" y="103" width="555" height="52"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{description}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="0" y="168" width="43" height="13"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Hvor:]]></text>
				</staticText>
				<textField>
					<reportElement x="0" y="188" width="141" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$P{BK_BUILDING_NAME}]]></textFieldExpression>
				</textField>
				<componentElement>
					<reportElement key="table" x="0" y="216" width="141" height="100"/>
					<jr:table xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
						<datasetRun subDataset="resources">
							<datasetParameter name="APPLICATION_ID">
								<datasetParameterExpression><![CDATA[$F{application_id}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
						<jr:column width="90">
							<jr:columnHeader height="15" rowSpan="1">
								<staticText>
									<reportElement x="0" y="0" width="90" height="13"/>
									<textElement/>
									<text><![CDATA[Ressurser]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="20" rowSpan="1">
								<textField>
									<reportElement x="0" y="0" width="90" height="20"/>
									<textElement/>
									<textFieldExpression class="java.lang.String"><![CDATA[$F{resource_name}]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="90">
							<jr:columnHeader height="15" rowSpan="1">
								<staticText>
									<reportElement x="0" y="0" width="90" height="13"/>
									<textElement/>
									<text><![CDATA[Type]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="20" rowSpan="1">
								<textField>
									<reportElement x="0" y="0" width="90" height="20"/>
									<textElement/>
									<textFieldExpression class="java.lang.String"><![CDATA[$F{resource_type}]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
					</jr:table>
				</componentElement>
				<staticText>
					<reportElement x="171" y="168" width="30" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Når:]]></text>
				</staticText>
				<staticText>
					<reportElement x="171" y="188" width="30" height="20"/>
					<textElement/>
					<text><![CDATA[Fra:]]></text>
				</staticText>
				<staticText>
					<reportElement x="171" y="216" width="30" height="20"/>
					<textElement/>
					<text><![CDATA[Til:]]></text>
				</staticText>
				<textField>
					<reportElement x="201" y="188" width="100" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{from}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="201" y="216" width="100" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{to}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="363" y="168" width="39" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Hvem:]]></text>
				</staticText>
				<componentElement>
					<reportElement key="table" x="363" y="188" width="192" height="128"/>
					<jr:table xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
						<datasetRun subDataset="targetaudience">
							<datasetParameter name="APPLICATION_ID">
								<datasetParameterExpression><![CDATA[$F{application_id}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
						<jr:column width="90">
							<jr:columnHeader height="16" rowSpan="1">
								<staticText>
									<reportElement x="0" y="0" width="90" height="16"/>
									<textElement/>
									<text><![CDATA[Målgruppe]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="20" rowSpan="1">
								<textField>
									<reportElement x="0" y="0" width="90" height="20"/>
									<textElement/>
									<textFieldExpression class="java.lang.String"><![CDATA[$F{targetaudience}]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
					</jr:table>
				</componentElement>
				<staticText>
					<reportElement x="363" y="326" width="100" height="13"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Antall deltakere]]></text>
				</staticText>
				<componentElement>
					<reportElement key="table" x="364" y="339" width="191" height="104"/>
					<jr:table xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
						<datasetRun subDataset="agegroup">
							<datasetParameter name="APPLICATION_ID">
								<datasetParameterExpression><![CDATA[$F{application_id}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
						<jr:column width="128">
							<jr:columnHeader height="14" rowSpan="1">
								<staticText>
									<reportElement x="0" y="0" width="90" height="14"/>
									<textElement/>
									<text><![CDATA[]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="20" rowSpan="1">
								<textField>
									<reportElement x="0" y="0" width="128" height="20"/>
									<textElement/>
									<textFieldExpression class="java.lang.String"><![CDATA[$F{agegroup}]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="35">
							<jr:columnHeader height="14" rowSpan="1">
								<staticText>
									<reportElement x="0" y="0" width="33" height="14"/>
									<textElement/>
									<text><![CDATA[Mann]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="20" rowSpan="1">
								<textField>
									<reportElement x="0" y="0" width="33" height="20"/>
									<textElement/>
									<textFieldExpression class="java.lang.Integer"><![CDATA[$F{male}]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="43">
							<jr:columnHeader height="14" rowSpan="1">
								<staticText>
									<reportElement x="0" y="0" width="43" height="14"/>
									<textElement/>
									<text><![CDATA[Kvinne]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="20" rowSpan="1">
								<textField>
									<reportElement x="0" y="0" width="43" height="20"/>
									<textElement/>
									<textFieldExpression class="java.lang.Integer"><![CDATA[$F{female}]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
					</jr:table>
				</componentElement>
			</elementGroup>
			<break>
				<reportElement x="0" y="458" width="100" height="1"/>
			</break>
		</band>
		<band height="287">
			<elementGroup>
				<componentElement>
					<reportElement x="0" y="120" width="553" height="54"/>
					<jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd" printOrder="Vertical">
						<datasetRun subDataset="comment">
							<datasetParameter name="APPLICATION_ID">
								<datasetParameterExpression><![CDATA[$F{application_id}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
						<jr:listContents height="54" width="553">
							<textField>
								<reportElement x="0" y="0" width="100" height="20"/>
								<textElement/>
								<textFieldExpression class="java.lang.String"><![CDATA[$F{date}]]></textFieldExpression>
							</textField>
							<textField>
								<reportElement x="100" y="0" width="100" height="20"/>
								<textElement/>
								<textFieldExpression class="java.lang.String"><![CDATA[$F{author}]]></textFieldExpression>
							</textField>
							<textField>
								<reportElement x="0" y="20" width="553" height="33"/>
								<textElement/>
								<textFieldExpression class="java.lang.String"><![CDATA[($F{comment} == "!The user has accepted the document under point 8." ? "Brukeren har akseptert dokumentene under punkt 8." : $F{comment} )]]></textFieldExpression>
							</textField>
						</jr:listContents>
					</jr:list>
				</componentElement>
				<staticText>
					<reportElement x="0" y="100" width="100" height="20"/>
					<textElement>
						<font size="12" isBold="true"/>
					</textElement>
					<text><![CDATA[Historikk]]></text>
				</staticText>
			</elementGroup>
			<elementGroup>
				<staticText>
					<reportElement x="0" y="0" width="141" height="20"/>
					<textElement>
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Kontaktinformasjon]]></text>
				</staticText>
				<staticText>
					<reportElement x="0" y="20" width="45" height="20"/>
					<textElement/>
					<text><![CDATA[Navn:]]></text>
				</staticText>
				<textField>
					<reportElement x="45" y="20" width="100" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{contact_name}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="0" y="40" width="45" height="20"/>
					<textElement/>
					<text><![CDATA[E-Post:]]></text>
				</staticText>
				<textField>
					<reportElement x="45" y="40" width="318" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{contact_email}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="0" y="60" width="45" height="20"/>
					<textElement/>
					<text><![CDATA[Telefon:]]></text>
				</staticText>
				<textField>
					<reportElement x="45" y="60" width="100" height="20"/>
					<textElement/>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{contact_phone}]]></textFieldExpression>
				</textField>
			</elementGroup>
		</band>
	</detail>
</jasperReport>
