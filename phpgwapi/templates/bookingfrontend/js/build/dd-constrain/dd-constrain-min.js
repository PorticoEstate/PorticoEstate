YUI.add("dd-constrain",function(t,i){var e,n="dragNode",s="offsetHeight",c="offsetWidth",r="host",a="tickXArray",h="tickYArray",g=t.DD.DDM,o="top",l="right",u="bottom",d="left",f="view",_="drag:tickAlignX",k="drag:tickAlignY",v=function(){this._lazyAddAttrs=!1,v.superclass.constructor.apply(this,arguments)};v.NAME="ddConstrained",v.NS="con",v.ATTRS={host:{},stickX:{value:!1},stickY:{value:!1},tickX:{value:!1},tickY:{value:!1},tickXArray:{value:!1},tickYArray:{value:!1},gutter:{value:"0",setter:function(i){return t.DD.DDM.cssSizestoObject(i)}},constrain:{value:f,setter:function(i){var e=t.one(i);return e&&(i=e),i}},constrain2region:{setter:function(t){return this.set("constrain",t)}},constrain2node:{setter:function(i){return this.set("constrain",t.one(i))}},constrain2view:{setter:function(){return this.set("constrain",f)}},cacheRegion:{value:!0}},e={_lastTickXFired:null,_lastTickYFired:null,initializer:function(){this._createEvents(),this._eventHandles=[this.get(r).on("drag:end",t.bind(this._handleEnd,this)),this.get(r).on("drag:start",t.bind(this._handleStart,this)),this.get(r).after("drag:align",t.bind(this.align,this)),this.get(r).after("drag:drag",t.bind(this.drag,this))]},destructor:function(){t.Array.each(this._eventHandles,function(t){t.detach()}),this._eventHandles.length=0},_createEvents:function(){var i=[_,k];t.Array.each(i,function(t){this.publish(t,{type:t,emitFacade:!0,bubbles:!0,queuable:!1,prefix:"drag"})},this)},_handleEnd:function(){this._lastTickYFired=null,this._lastTickXFired=null},_handleStart:function(){this.resetCache()},_regionCache:null,_cacheRegion:function(){this._regionCache=this.get("constrain").get("region")},resetCache:function(){this._regionCache=null},_getConstraint:function(){var i,e=this.get("constrain"),s=this.get("gutter");return e&&(e instanceof t.Node?(this._regionCache||(this._eventHandles.push(t.on("resize",t.bind(this._cacheRegion,this),t.config.win)),this._cacheRegion()),i=t.clone(this._regionCache),this.get("cacheRegion")||this.resetCache()):t.Lang.isObject(e)&&(i=t.clone(e))),e&&i||(e=f),e===f&&(i=this.get(r).get(n).get("viewportRegion")),t.Object.each(s,function(t,e){e===l||e===u?i[e]-=t:i[e]+=t}),i},getRegion:function(t){var i={},e=null,a=null,h=this.get(r);return i=this._getConstraint(),t&&(e=h.get(n).get(s),a=h.get(n).get(c),i[l]=i[l]-a,i[u]=i[u]-e),i},_checkRegion:function(t){var i=t,e=this.getRegion(),a=this.get(r),h=a.get(n).get(s),g=a.get(n).get(c);return i[1]>e[u]-h&&(t[1]=e[u]-h),e[o]>i[1]&&(t[1]=e[o]),i[0]>e[l]-g&&(t[0]=e[l]-g),e[d]>i[0]&&(t[0]=e[d]),t},inRegion:function(t){t=t||this.get(r).get(n).getXY();var i=this._checkRegion([t[0],t[1]]),e=!1;return t[0]===i[0]&&t[1]===i[1]&&(e=!0),e},align:function(){var t=this.get(r),i=[t.actXY[0],t.actXY[1]],e=this.getRegion(!0);this.get("stickX")&&(i[1]=t.startXY[1]-t.deltaXY[1]),this.get("stickY")&&(i[0]=t.startXY[0]-t.deltaXY[0]),e&&(i=this._checkRegion(i)),i=this._checkTicks(i,e),t.actXY=i},drag:function(){var i=this.get(r),e=this.get("tickX"),n=this.get("tickY"),s=[i.actXY[0],i.actXY[1]];(t.Lang.isNumber(e)||this.get(a))&&this._lastTickXFired!==s[0]&&(this._tickAlignX(),this._lastTickXFired=s[0]),(t.Lang.isNumber(n)||this.get(h))&&this._lastTickYFired!==s[1]&&(this._tickAlignY(),this._lastTickYFired=s[1])},_checkTicks:function(t,i){var e=this.get(r),n=e.startXY[0]-e.deltaXY[0],s=e.startXY[1]-e.deltaXY[1],c=this.get("tickX"),f=this.get("tickY");return c&&!this.get(a)&&(t[0]=g._calcTicks(t[0],n,c,i[d],i[l])),f&&!this.get(h)&&(t[1]=g._calcTicks(t[1],s,f,i[o],i[u])),this.get(a)&&(t[0]=g._calcTickArray(t[0],this.get(a),i[d],i[l])),this.get(h)&&(t[1]=g._calcTickArray(t[1],this.get(h),i[o],i[u])),t},_tickAlignX:function(){this.fire(_)},_tickAlignY:function(){this.fire(k)}},t.namespace("Plugin"),t.extend(v,t.Base,e),t.Plugin.DDConstrained=v,t.mix(g,{_calcTicks:function(t,i,e,n,s){var c=(t-i)/e,r=Math.floor(c),a=Math.ceil(c);return 0===r&&0===a||c>=r&&c<=a&&(t=i+e*r,n&&s&&(t<n&&(t=i+e*(r+1)),t>s&&(t=i+e*(r-1)))),t},_calcTickArray:function(t,i,e,n){var s,c,r=0,a=i.length,h=0;if(!i||0===i.length)return t;if(i[0]>=t)return i[0];for(r=0;r<a;r++)if(i[h=r+1]&&i[h]>=t)return s=t-i[r],c=i[h]-t>s?i[r]:i[h],e&&n&&c>n&&(c=i[r]?i[r]:i[a-1]),c;return i[i.length-1]}})},"patched-v3.18.1",{requires:["dd-drag"]});