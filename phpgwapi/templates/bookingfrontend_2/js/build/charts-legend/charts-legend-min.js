YUI.add("charts-legend",function(t,e){var i,h="top",s="right",r="bottom",a="left",n="horizontal",o="width",g="height",l="position",d="x",c="y",f="px",u={setter:function(e){var i=this.get("legend");return i&&i.destroy(!0),e instanceof t.ChartLegend?(i=e).set("chart",this):(e.chart=this,e.hasOwnProperty("render")||(e.render=this.get("contentBox"),e.includeInChartLayout=!0),i=new t.ChartLegend(e)),i}},y={_positionLegendItems:function(t,e,i,h,s,r,a,n,o){var g,l,d,c,u,p,_,w,b,m,S,v,C,L,x=0,k=0,A=this.get("width"),B=r.top-n,I=A-(r.left+r.right);for(y._setRowArrays(t,I,a),p=y.rowArray,b=y.totalWidthArray,_=p.length;k<_;++k){for(B+=n,u=(w=p[k]).length,m=y.getStartPoint(A,b[k],o,r),x=0;x<u;++x)l=(g=w[x]).node,d=g.width,c=g.height,g.x=m,g.y=0,S=isNaN(S)?m:Math.min(S,m),v=isNaN(v)?B:Math.min(v,B),C=isNaN(C)?m+d:Math.max(m+d,C),L=isNaN(L)?B+c:Math.max(B+c,L),l.setStyle("left",m+f),l.setStyle("top",B+f),m+=d+a;B+=g.height}this._contentRect={left:S,top:v,right:C,bottom:L},this.get("includeInChartLayout")&&this.set("height",B+r.bottom)},_setRowArrays:function(t,e,i){for(var h,s=t[0],r=[[s]],a=1,n=0,o=t.length,g=s.width,l=[[g]];a<o;++a)g+i+(h=(s=t[a]).width)<=e?(g+=i+h,r[n].push(s)):(g=i+h,r[n]&&(n+=1),r[n]=[s]),l[n]=g;y.rowArray=r,y.totalWidthArray=l},getStartPoint:function(t,e,i,h){var r;switch(i){case a:r=h.left;break;case"center":r=.5*(t-e);break;case s:r=t-e-h.right}return r}},p={_positionLegendItems:function(t,e,i,h,s,r,a,n,o){var g,l,d,c,u,y,_,w,b,m,S,v,C,L,x,k=0,A=0,B=this.get("height"),I=r.left-a,N=B-(r.top+r.bottom);for(p._setColumnArrays(t,N,n),y=p.columnArray,b=p.totalHeightArray,_=y.length;A<_;++A){for(I+=a,u=(w=y[A]).length,m=p.getStartPoint(B,b[A],o,r),S=0,k=0;k<u;++k)l=(g=w[k]).node,d=g.height,c=g.width,g.y=m,g.x=I,v=isNaN(v)?I:Math.min(v,I),C=isNaN(C)?m:Math.min(C,m),L=isNaN(L)?I+c:Math.max(I+c,L),x=isNaN(x)?m+d:Math.max(m+d,x),l.setStyle("left",I+f),l.setStyle("top",m+f),m+=d+n,S=Math.max(S,g.width);I+=S}this._contentRect={left:v,top:C,right:L,bottom:x},this.get("includeInChartLayout")&&this.set("width",I+r.right)},_setColumnArrays:function(t,e,i){for(var h,s=t[0],r=[[s]],a=1,n=0,o=t.length,g=s.height,l=[[g]];a<o;++a)g+i+(h=(s=t[a]).height)<=e?(g+=i+h,r[n].push(s)):(g=i+h,r[n]&&(n+=1),r[n]=[s]),l[n]=g;p.columnArray=r,p.totalHeightArray=l},getStartPoint:function(t,e,i,s){var a;switch(i){case h:a=s.top;break;case"middle":a=.5*(t-e);break;case r:a=t-e-s.bottom}return a}},_=t.Base.create("cartesianChartLegend",t.CartesianChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1;var t,e,i,h,s,r,a,n,o,g,l,d,c,u,y,p=this.get("width"),_=this.get("height"),w=this._getLayoutBoxDimensions(),b=w.left,m=w.right,S=w.top,v=w.bottom,C=this.get("leftAxesCollection"),L=this.get("rightAxesCollection"),x=this.get("topAxesCollection"),k=this.get("bottomAxesCollection"),A=0,B="visible",I=this.get("graph"),N=this.get("allowContentOverflow"),M=this.get("legend"),R={};if(C)for(c=[],A=(t=C.length)-1;A>-1;--A)c.unshift(b),b+=C[A].get("width");if(L)for(d=[],A=0,A=(t=L.length)-1;A>-1;--A)m+=L[A].get("width"),d.unshift(p-m);if(x)for(u=[],A=(t=x.length)-1;A>-1;--A)u.unshift(S),S+=x[A].get("height");if(k)for(y=[],A=(t=k.length)-1;A>-1;--A)v+=k[A].get("height"),y.unshift(_-v);if(p-(b+m),_-(v+S),R.left=b,R.top=S,R.bottom=_-v,R.right=p-m,!N){if(i=this._getTopOverflow(C,L),h=this._getBottomOverflow(C,L),s=this._getLeftOverflow(k,x),r=this._getRightOverflow(k,x),(l=i-S)>0&&(R.top=i,u))for(A=0,t=u.length;A<t;++A)u[A]+=l;if((l=h-v)>0&&(R.bottom=_-h,y))for(A=0,t=y.length;A<t;++A)y[A]-=l;if((l=s-b)>0&&(R.left=s,c))for(A=0,t=c.length;A<t;++A)c[A]+=l;if((l=r-m)>0&&(R.right=p-r,d))for(A=0,t=d.length;A<t;++A)d[A]-=l}if(a=R.right-R.left,n=R.bottom-R.top,o=R.left,g=R.top,M&&M.get("includeInChartLayout"))switch(M.get("position")){case"left":M.set("y",g),M.set("height",n);break;case"top":case"bottom":M.set("x",o),M.set("width",a);break;case"right":M.set("y",g),M.set("height",n)}if(x){for(t=x.length,A=0;A<t;A++)(e=x[A]).get("width")!==a&&e.set("width",a),e.get("boundingBox").setStyle("left",o+f),e.get("boundingBox").setStyle("top",u[A]+f);e._hasDataOverflow()&&(B="hidden")}if(k){for(t=k.length,A=0;A<t;A++)(e=k[A]).get("width")!==a&&e.set("width",a),e.get("boundingBox").setStyle("left",o+f),e.get("boundingBox").setStyle("top",y[A]+f);e._hasDataOverflow()&&(B="hidden")}if(C){for(t=C.length,A=0;A<t;++A)(e=C[A]).get("boundingBox").setStyle("top",g+f),e.get("boundingBox").setStyle("left",c[A]+f),e.get("height")!==n&&e.set("height",n);e._hasDataOverflow()&&(B="hidden")}if(L){for(t=L.length,A=0;A<t;++A)(e=L[A]).get("boundingBox").setStyle("top",g+f),e.get("boundingBox").setStyle("left",d[A]+f),e.get("height")!==n&&e.set("height",n);e._hasDataOverflow()&&(B="hidden")}this._drawing=!1,this._callLater?this._redraw():(I&&(I.get("boundingBox").setStyle("left",o+f),I.get("boundingBox").setStyle("top",g+f),I.set("width",a),I.set("height",n),I.get("boundingBox").setStyle("overflow",B)),this._overlay&&(this._overlay.setStyle("left",o+f),this._overlay.setStyle("top",g+f),this._overlay.setStyle("width",a+f),this._overlay.setStyle("height",n+f)))}},_getLayoutBoxDimensions:function(){var t,e,i,f,u={top:0,right:0,bottom:0,left:0},y=this.get("legend"),p=this.get(o),_=this.get(g);if(y&&y.get("includeInChartLayout")&&(f=y.get("styles").gap,"external"!==(t=y.get(l))))switch(e=y.get("direction")===n?g:o,i=y.get(e),u[t]=i+f,t){case h:y.set(c,0);break;case r:y.set(c,_-i);break;case s:y.set(d,p-i);break;case a:y.set(d,0)}return u},destructor:function(){var t=this.get("legend");t&&t.destroy(!0)}},{ATTRS:{legend:u}});t.CartesianChart=_,i=t.Base.create("pieChartLegend",t.PieChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1;var t,e,i,n,l,f,u,y=this.get("graph"),p=this.get("width"),_=this.get("height"),w=this.get("legend"),b=0,m=0,S=0,v=0;if(y)if(w)if(w.get("position"),u=w.get("direction"),t=y.get("width"),e=y.get("height"),i=w.get("width"),n=w.get("height"),
f=w.get("styles").gap,"vertical"===u&&t+i+f!==p||"horizontal"===u&&e+n+f!==_){switch(w.get("position")){case a:l=Math.min(p-(i+f),_),n=_,b=i+f,w.set(g,n);break;case h:l=Math.min(_-(n+f),p),i=p,m=n+f,w.set(o,i);break;case s:n=_,S=(l=Math.min(p-(i+f),_))+f,w.set(g,n);break;case r:i=p,v=(l=Math.min(_-(n+f),p))+f,w.set(o,i)}y.set(o,l),y.set(g,l)}else switch(w.get("position")){case a:b=i+f;break;case h:m=n+f;break;case s:S=t+f;break;case r:v=e+f}else y.set(d,0),y.set(c,0),y.set(o,p),y.set(g,_);this._drawing=!1,this._callLater?this._redraw():(y&&(y.set(d,b),y.set(c,m)),w&&(w.set(d,S),w.set(c,v)))}}},{ATTRS:{legend:u}}),t.PieChart=i,t.ChartLegend=t.Base.create("chartlegend",t.Widget,[t.Renderer],{initializer:function(){this._items=[]},renderUI:function(){var e=this.get("boundingBox"),i=this.get("contentBox"),h=this.get("styles").background,s=new t.Rect({graphic:i,fill:h.fill,stroke:h.border});e.setStyle("display","block"),e.setStyle("position","absolute"),this.set("background",s)},bindUI:function(){this.get("chart").after("seriesCollectionChange",t.bind(this._updateHandler,this)),this.get("chart").after("stylesChange",t.bind(this._updateHandler,this)),this.after("stylesChange",this._updateHandler),this.after("positionChange",this._positionChangeHandler),this.after("widthChange",this._handleSizeChange),this.after("heightChange",this._handleSizeChange)},syncUI:function(){var t=this.get("width"),e=this.get("height");isFinite(t)&&isFinite(e)&&t>0&&e>0&&this._drawLegend()},_updateHandler:function(){this.get("rendered")&&this._drawLegend()},_positionChangeHandler:function(){var t=this.get("chart");this._parentNode&&t&&this.get("includeInChartLayout")?this.fire("legendRendered"):this.get("rendered")&&this._drawLegend()},_handleSizeChange:function(t){var e=t.attrName,i=this.get(l);((i===r||i===h)&&e===o||(i===a||i===s)&&e===g)&&this._drawLegend()},_drawLegend:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1,this.get("includeInChartLayout")&&this.get("chart")._itemRenderQueue.unshift(this);var e,i,h,s,r,a,n,o,g,l,d,c,f,u,y,p,_=this.get("chart"),w=this.get("contentBox"),b=_.get("seriesCollection"),m=this.get("styles"),S=m.padding,v=m.item,C=v.hSpacing,L=v.vSpacing,x=this.get("direction"),k="vertical"===x?m.vAlign:m.hAlign,A=m.marker,B=v.label,I=this._layout[x],N=[],M=A.width,R=A.height,D=0-C,O=0-L,z=0,H=0;if(A&&A.shape&&(n=A.shape),this._destroyLegendItems(),_ instanceof t.PieChart)for(h=(e=b[0]).get("categoryAxis").getDataByKey(e.get("categoryKey")),c=(i=e.get("styles").marker).fill.colors,f=i.border.colors,u=i.border.weight,s=0,r=h.length,o=n||t.Circle,a=t.Lang.isArray(o);s<r;++s)o=a?o[s]:o,l={color:c[s]},d={colors:f[s],weight:u},h=_.getSeriesItems(e,s).category.value,y=(g=this._getLegendItem(w,this._getShapeClass(o),l,d,B,M,R,h)).width,p=g.height,z=Math.max(z,y),H=Math.max(H,p),D+=y+C,O+=p+L,N.push(g);else for(s=0,r=b.length;s<r;++s)e=b[s],i=this._getStylesBySeriesType(e,o),n||(o=i.shape)||(o=t.Circle),t.Lang.isArray(o)?o[s]:o,y=(g=this._getLegendItem(w,this._getShapeClass(o),i.fill,i.border,B,M,R,e.get("valueDisplayName"))).width,p=g.height,z=Math.max(z,y),H=Math.max(H,p),D+=y+C,O+=p+L,N.push(g);this._drawing=!1,this._callLater?this._drawLegend():(I._positionLegendItems.apply(this,[N,z,H,D,O,S,C,L,k]),this._updateBackground(m),this.fire("legendRendered"))}},_updateBackground:function(t){var e=t.background,i=this._contentRect,h=t.padding,s=i.left-h.left,r=i.top-h.top,a=i.right-s+h.right,n=i.bottom-r+h.bottom;this.get("background").set({fill:e.fill,stroke:e.border,width:a,height:n,x:s,y:r})},_getStylesBySeriesType:function(e){var i,h=e.get("styles");return e instanceof t.LineSeries||e instanceof t.StackedLineSeries?{border:{weight:1,color:i=(h=e.get("styles").line).color||e._getDefaultColor(e.get("graphOrder"),"line")},fill:{color:i}}:e instanceof t.AreaSeries||e instanceof t.StackedAreaSeries?{border:{weight:1,color:i=(h=e.get("styles").area).color||e._getDefaultColor(e.get("graphOrder"),"slice")},fill:{color:i}}:{fill:(h=e.get("styles").marker).fill,border:{weight:h.border.weight,color:h.border.color,shape:h.shape},shape:h.shape}},_getLegendItem:function(e,i,h,s,r,a,n,o){var g,d,c,u,y,p=t.Node.create("<div>"),_=t.Node.create("<span>"),w=i;return p.setStyle(l,"absolute"),_.setStyle(l,"absolute"),_.setStyles(r),_.set("text",o),p.appendChild(_),e.append(p),u=a+(c=(d=_.get("offsetHeight"))-n)+2,_.setStyle("left",u+f),p.setStyle("height",d+f),p.setStyle("width",u+_.get("offsetWidth")+f),g=new w({fill:h,stroke:s,width:a,height:n,x:.5*c,y:.5*c,w:a,h:n,graphic:p}),_.setStyle("left",d+f),y={node:p,width:p.get("offsetWidth"),height:p.get("offsetHeight"),shape:g,textNode:_,text:o},this._items.push(y),y},_getShapeClass:function(){var t=this.get("background").get("graphic");return t._getShapeClass.apply(t,arguments)},_getDefaultStyles:function(){return{padding:{top:8,right:8,bottom:8,left:9},gap:10,hAlign:"center",vAlign:"top",marker:this._getPlotDefaults(),item:{hSpacing:10,vSpacing:5,label:{color:"#808080",fontSize:"85%",whiteSpace:"nowrap"}},background:{shape:"rect",fill:{color:"#faf9f2"},border:{color:"#dad8c9",weight:1}}}},_getPlotDefaults:function(){return{width:10,height:10}},_destroyLegendItems:function(){var t;if(this._items)for(;this._items.length>0;)(t=this._items.shift()).shape.get("graphic").destroy(),t.node.empty(),t.node.destroy(!0),t.node=null,t=null;this._items=[]},_layout:{vertical:p,horizontal:y},destructor:function(){var t,e=this.get("background");this._destroyLegendItems(),e&&((t=e.get("graphic"))?t.destroy():e.destroy())}},{ATTRS:{includeInChartLayout:{value:!1},chart:{setter:function(e){return this.after("legendRendered",t.bind(e._itemRendered,e)),e}},direction:{value:"vertical"},position:{lazyAdd:!1,value:"right",setter:function(t){return t===h||t===r?this.set("direction",n):t!==a&&t!==s||this.set("direction","vertical"),t}},width:{getter:function(){var t=this.get("chart"),e=this._parentNode
;return e?t&&this.get("includeInChartLayout")||this._width?(this._width||(this._width=0),this._width):e.get("offsetWidth"):""},setter:function(t){return this._width=t,t}},height:{valueFn:"_heightGetter",getter:function(){var t=this.get("chart"),e=this._parentNode;return e?t&&this.get("includeInChartLayout")||this._height?(this._height||(this._height=0),this._height):e.get("offsetHeight"):""},setter:function(t){return this._height=t,t}},x:{lazyAdd:!1,value:0,setter:function(t){var e=this.get("boundingBox");return e&&e.setStyle(a,t+f),t}},y:{lazyAdd:!1,value:0,setter:function(t){var e=this.get("boundingBox");return e&&e.setStyle(h,t+f),t}},items:{getter:function(){return this._items}},background:{}}})},"patched-v3.18.1",{requires:["charts-base"]});