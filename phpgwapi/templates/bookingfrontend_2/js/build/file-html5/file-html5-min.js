YUI.add("file-html5",function(e,t){e.Lang;var i=e.bind,a=e.config.win,n=function(e){var t=e;n.superclass.constructor.apply(this,arguments),t&&n.canUpload()&&(this.get("file")||this._set("file",t),this.get("name")||this._set("name",t.name||t.fileName),this.get("size")!=(t.size||t.fileSize)&&this._set("size",t.size||t.fileSize),this.get("type")||this._set("type",t.type),t.hasOwnProperty("lastModifiedDate")&&!this.get("dateModified")&&this._set("dateModified",t.lastModifiedDate))};e.extend(n,e.Base,{initializer:function(t){this.get("id")||this._set("id",e.guid("file"))},_uploadEventHandler:function(e){var t,i,a=this.get("xhr");switch(e.type){case"progress":this.fire("uploadprogress",{originEvent:e,bytesLoaded:e.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*e.loaded/this.get("size"))/100)}),this._set("bytesUploaded",e.loaded);break;case"load":a.status>=200&&a.status<=299?(this.fire("uploadcomplete",{originEvent:e,data:e.target.responseText}),t=a.upload,i=this.get("boundEventHandler"),t.removeEventListener("progress",i),t.removeEventListener("error",i),t.removeEventListener("abort",i),a.removeEventListener("load",i),a.removeEventListener("error",i),a.removeEventListener("readystatechange",i),this._set("xhr",null)):this.fire("uploaderror",{originEvent:e,data:a.responseText,status:a.status,statusText:a.statusText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:e,data:a.responseText,status:a.status,statusText:a.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:e});break;case"readystatechange":this.fire("readystatechange",{readyState:e.target.readyState,originEvent:e})}},startUpload:function(t,a,n){this._set("bytesUploaded",0),this._set("xhr",new XMLHttpRequest),this._set("boundEventHandler",i(this._uploadEventHandler,this));var s=new FormData,r=n||"Filedata",d=this.get("xhr"),l=this.get("xhr").upload,o=this.get("boundEventHandler");e.each(a,function(e,t){s.append(t,e)}),s.append(r,this.get("file")),d.addEventListener("loadstart",o,!1),l.addEventListener("progress",o,!1),d.addEventListener("load",o,!1),d.addEventListener("error",o,!1),l.addEventListener("error",o,!1),l.addEventListener("abort",o,!1),d.addEventListener("abort",o,!1),d.addEventListener("loadend",o,!1),d.addEventListener("readystatechange",o,!1),d.open("POST",t,!0),d.withCredentials=this.get("xhrWithCredentials"),e.each(this.get("xhrHeaders"),function(e,t){d.setRequestHeader(t,e)}),d.send(s),this.fire("uploadstart",{xhr:d})},cancelUpload:function(){var e=this.get("xhr");e&&e.abort()}},{NAME:"file",TYPE:"html5",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},file:{writeOnce:"initOnly",value:null},xhr:{readOnly:!0,value:null},xhrHeaders:{value:{}},xhrWithCredentials:{value:!0},boundEventHandler:{readOnly:!0,value:null}},isValidFile:function(e){return a&&a.File&&e instanceof File},canUpload:function(){return a&&a.FormData&&a.XMLHttpRequest}}),e.FileHTML5=n},"patched-v3.18.1",{requires:["base"]});